<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.68">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta property="og:url" content="https://saynop.github.io/detail/007.html"><meta property="og:title" content="安卓NDK开发"><meta property="og:description" content="静态注册开发流程 以java层获取C层返回字符串为例的安卓应用开发流程 在java中定义native方法 参考以下例子编写java层的类，在类中定义需要通过c语言实现的native方法 package com.example.testndk; import android.R.string; public class MainActivity extends Activity { @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); // 弹窗显示出native函数调用结果 // 第一个参数是上下文，这里直接传入this // 第二个参数是显示内容，这里直接调用jni函数，打印函数返回值 // 第三个参数是弹窗时间 Toast.makeText(this, getstring(), Toast.LENGTH_LONG).show(); } // native方法的定义 - 从c层得到返回字段 public native CharSequence getstring(); }"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-10-18T06:41:25.000Z"><meta property="article:tag" content="Android"><meta property="article:tag" content="Ndk"><meta property="article:published_time" content="2023-05-05T00:00:00.000Z"><meta property="article:modified_time" content="2023-10-18T06:41:25.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"安卓NDK开发","image":[""],"datePublished":"2023-05-05T00:00:00.000Z","dateModified":"2023-10-18T06:41:25.000Z","author":[]}</script><link rel="icon" href="/favicon.ico"><title>安卓NDK开发</title><meta name="description" content="静态注册开发流程 以java层获取C层返回字符串为例的安卓应用开发流程 在java中定义native方法 参考以下例子编写java层的类，在类中定义需要通过c语言实现的native方法 package com.example.testndk; import android.R.string; public class MainActivity extends Activity { @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); // 弹窗显示出native函数调用结果 // 第一个参数是上下文，这里直接传入this // 第二个参数是显示内容，这里直接调用jni函数，打印函数返回值 // 第三个参数是弹窗时间 Toast.makeText(this, getstring(), Toast.LENGTH_LONG).show(); } // native方法的定义 - 从c层得到返回字段 public native CharSequence getstring(); }">
    <link rel="preload" href="/assets/style-3253bf1b.css" as="style"><link rel="stylesheet" href="/assets/style-3253bf1b.css">
    <link rel="modulepreload" href="/assets/app-456349e5.js"><link rel="modulepreload" href="/assets/007.html-fddf5fc0.js"><link rel="modulepreload" href="/assets/007.html-d3b6ddc8.js">
    <link rel="prefetch" href="/assets/index.html-f33fda43.js" as="script"><link rel="prefetch" href="/assets/001.html-12451cc3.js" as="script"><link rel="prefetch" href="/assets/002.html-a6d5828c.js" as="script"><link rel="prefetch" href="/assets/003.html-3e8b49c2.js" as="script"><link rel="prefetch" href="/assets/004.html-689926d8.js" as="script"><link rel="prefetch" href="/assets/005.html-d6b96039.js" as="script"><link rel="prefetch" href="/assets/006.html-5b50a542.js" as="script"><link rel="prefetch" href="/assets/008.html-834ef0e1.js" as="script"><link rel="prefetch" href="/assets/009.html-7d1574d7.js" as="script"><link rel="prefetch" href="/assets/010.html-f1724340.js" as="script"><link rel="prefetch" href="/assets/011.html-10672fd1.js" as="script"><link rel="prefetch" href="/assets/012.html-5e7aa08e.js" as="script"><link rel="prefetch" href="/assets/013.html-8dd46ba3.js" as="script"><link rel="prefetch" href="/assets/014.html-d0db391f.js" as="script"><link rel="prefetch" href="/assets/015.html-7a04f43c.js" as="script"><link rel="prefetch" href="/assets/016.html-79bc20a6.js" as="script"><link rel="prefetch" href="/assets/017.html-f2df444a.js" as="script"><link rel="prefetch" href="/assets/404.html-a0fec2a7.js" as="script"><link rel="prefetch" href="/assets/index.html-75381ff5.js" as="script"><link rel="prefetch" href="/assets/index.html-c95ce669.js" as="script"><link rel="prefetch" href="/assets/index.html-2c56dc8e.js" as="script"><link rel="prefetch" href="/assets/index.html-98874abd.js" as="script"><link rel="prefetch" href="/assets/index.html-b2308fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-10e703b4.js" as="script"><link rel="prefetch" href="/assets/index.html-5f3af54d.js" as="script"><link rel="prefetch" href="/assets/index.html-56349a98.js" as="script"><link rel="prefetch" href="/assets/index.html-a7c2713a.js" as="script"><link rel="prefetch" href="/assets/index.html-2e96c3d2.js" as="script"><link rel="prefetch" href="/assets/index.html-9f1eff22.js" as="script"><link rel="prefetch" href="/assets/index.html-16b34053.js" as="script"><link rel="prefetch" href="/assets/index.html-4e233464.js" as="script"><link rel="prefetch" href="/assets/index.html-d90f0ec9.js" as="script"><link rel="prefetch" href="/assets/index.html-3202320f.js" as="script"><link rel="prefetch" href="/assets/index.html-c3fe2c85.js" as="script"><link rel="prefetch" href="/assets/index.html-f3052411.js" as="script"><link rel="prefetch" href="/assets/index.html-5485bfc3.js" as="script"><link rel="prefetch" href="/assets/index.html-a7568890.js" as="script"><link rel="prefetch" href="/assets/index.html-9d25f5f2.js" as="script"><link rel="prefetch" href="/assets/index.html-ff33d682.js" as="script"><link rel="prefetch" href="/assets/index.html-3bce843e.js" as="script"><link rel="prefetch" href="/assets/index.html-09b9da96.js" as="script"><link rel="prefetch" href="/assets/index.html-750acad1.js" as="script"><link rel="prefetch" href="/assets/index.html-1c1e573d.js" as="script"><link rel="prefetch" href="/assets/index.html-8eb4570b.js" as="script"><link rel="prefetch" href="/assets/index.html-7dd1db94.js" as="script"><link rel="prefetch" href="/assets/index.html-32048506.js" as="script"><link rel="prefetch" href="/assets/index.html-a4e9e805.js" as="script"><link rel="prefetch" href="/assets/index.html-df3e534f.js" as="script"><link rel="prefetch" href="/assets/index.html-cb3cc9f5.js" as="script"><link rel="prefetch" href="/assets/index.html-0994fca8.js" as="script"><link rel="prefetch" href="/assets/index.html-a902e771.js" as="script"><link rel="prefetch" href="/assets/index.html-76fbbff6.js" as="script"><link rel="prefetch" href="/assets/index.html-7bc29919.js" as="script"><link rel="prefetch" href="/assets/index.html-2642a77f.js" as="script"><link rel="prefetch" href="/assets/index.html-8dfad283.js" as="script"><link rel="prefetch" href="/assets/index.html-0e75c0da.js" as="script"><link rel="prefetch" href="/assets/index.html-1d59d05d.js" as="script"><link rel="prefetch" href="/assets/index.html-0dcf6866.js" as="script"><link rel="prefetch" href="/assets/001.html-06a01033.js" as="script"><link rel="prefetch" href="/assets/002.html-eca5033a.js" as="script"><link rel="prefetch" href="/assets/003.html-96f2bf15.js" as="script"><link rel="prefetch" href="/assets/004.html-942c14d5.js" as="script"><link rel="prefetch" href="/assets/005.html-aac2dc0f.js" as="script"><link rel="prefetch" href="/assets/006.html-27cf0cfd.js" as="script"><link rel="prefetch" href="/assets/008.html-d44e42af.js" as="script"><link rel="prefetch" href="/assets/009.html-52dd1f1e.js" as="script"><link rel="prefetch" href="/assets/010.html-67d49311.js" as="script"><link rel="prefetch" href="/assets/011.html-d40a0826.js" as="script"><link rel="prefetch" href="/assets/012.html-96f1f714.js" as="script"><link rel="prefetch" href="/assets/013.html-aad3c047.js" as="script"><link rel="prefetch" href="/assets/014.html-c76a34fa.js" as="script"><link rel="prefetch" href="/assets/015.html-f37a06a2.js" as="script"><link rel="prefetch" href="/assets/016.html-0390a7f5.js" as="script"><link rel="prefetch" href="/assets/017.html-2d71e267.js" as="script"><link rel="prefetch" href="/assets/404.html-0ded94f5.js" as="script"><link rel="prefetch" href="/assets/index.html-cc10c2fa.js" as="script"><link rel="prefetch" href="/assets/index.html-6a26b22e.js" as="script"><link rel="prefetch" href="/assets/index.html-b3501216.js" as="script"><link rel="prefetch" href="/assets/index.html-09fb8003.js" as="script"><link rel="prefetch" href="/assets/index.html-cb62c023.js" as="script"><link rel="prefetch" href="/assets/index.html-ead2549d.js" as="script"><link rel="prefetch" href="/assets/index.html-b0273b6b.js" as="script"><link rel="prefetch" href="/assets/index.html-ecfdac71.js" as="script"><link rel="prefetch" href="/assets/index.html-9a4d3031.js" as="script"><link rel="prefetch" href="/assets/index.html-dcbfbeb3.js" as="script"><link rel="prefetch" href="/assets/index.html-3450700a.js" as="script"><link rel="prefetch" href="/assets/index.html-6a1215f6.js" as="script"><link rel="prefetch" href="/assets/index.html-ad4a2369.js" as="script"><link rel="prefetch" href="/assets/index.html-2622b5b6.js" as="script"><link rel="prefetch" href="/assets/index.html-e9474906.js" as="script"><link rel="prefetch" href="/assets/index.html-f1c2f850.js" as="script"><link rel="prefetch" href="/assets/index.html-e294b0ef.js" as="script"><link rel="prefetch" href="/assets/index.html-697db01c.js" as="script"><link rel="prefetch" href="/assets/index.html-ee2ea90a.js" as="script"><link rel="prefetch" href="/assets/index.html-1c4dc494.js" as="script"><link rel="prefetch" href="/assets/index.html-dfd94f40.js" as="script"><link rel="prefetch" href="/assets/index.html-bb7cdebb.js" as="script"><link rel="prefetch" href="/assets/index.html-66eb39d3.js" as="script"><link rel="prefetch" href="/assets/index.html-b722985f.js" as="script"><link rel="prefetch" href="/assets/index.html-9daf7087.js" as="script"><link rel="prefetch" href="/assets/index.html-00831790.js" as="script"><link rel="prefetch" href="/assets/index.html-e3fdd6b8.js" as="script"><link rel="prefetch" href="/assets/index.html-33d24df0.js" as="script"><link rel="prefetch" href="/assets/index.html-909b3e64.js" as="script"><link rel="prefetch" href="/assets/index.html-c3b55a7e.js" as="script"><link rel="prefetch" href="/assets/index.html-19616eec.js" as="script"><link rel="prefetch" href="/assets/index.html-66b1eb35.js" as="script"><link rel="prefetch" href="/assets/index.html-8d052155.js" as="script"><link rel="prefetch" href="/assets/index.html-d0d3c0ba.js" as="script"><link rel="prefetch" href="/assets/index.html-648c6568.js" as="script"><link rel="prefetch" href="/assets/index.html-50884dd2.js" as="script"><link rel="prefetch" href="/assets/index.html-ad321dbc.js" as="script"><link rel="prefetch" href="/assets/index.html-c0eb9159.js" as="script"><link rel="prefetch" href="/assets/index.html-4d668d75.js" as="script"><link rel="prefetch" href="/assets/giscus-0b7adcf8.js" as="script"><link rel="prefetch" href="/assets/SearchResult-13418284.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div data-v-77edf713><header class="header" style="opacity:0;" data-v-90176301><div class="header_container" data-v-90176301><div data-v-90176301><a class="header_title" href="/" data-v-90176301>Leopold&#39;s Blog</a></div><div class="appearance" data-v-90176301><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><!----></button><!--]--><button class="switch" data-v-90176301><span class="icon" style="display:block;" data-v-90176301><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" style="" data-v-90176301><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" style="display:none;" data-v-90176301><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></button><button class="switch mobile_list_btn" type="button" data-v-90176301><span class="btn_top" data-v-90176301></span><span class="btn_middle" data-v-90176301></span><span class="btn_bottom" data-v-90176301></span></button></div></div></header><div class="main"><div class="background" data-v-fee8de4c><svg class="pull_down" viewbox="0 0 1026 1024" xmlns="http://www.w3.org/2000/svg" data-v-fee8de4c data-v-3c8412b0><path d="M857.088 224.256q28.672-28.672 69.12-28.672t69.12 28.672q29.696 28.672 29.696 68.608t-29.696 68.608l-382.976 380.928q-12.288 14.336-30.72 19.968t-38.912 4.608-40.448-8.704-34.304-22.016l-376.832-374.784q-29.696-28.672-29.696-68.608t29.696-68.608q14.336-14.336 32.256-21.504t36.864-7.168 37.376 7.168 32.768 21.504l313.344 309.248z" data-v-3c8412b0></path></svg></div><div style="display:flex;"><div class="sider_keeper" data-v-e01a06ce><div class="folding" data-v-e01a06ce><!-- <div class="folding"> --><div class="sidebar_top card_border" style="min-height:1rem" data-v-e01a06ce><div class="tags_brand" data-v-e01a06ce>本文大纲</div><section class="article_sidebar" data-v-e01a06ce data-v-905b99e1><ul data-v-905b99e1><!--[--><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#静态注册开发流程" data-v-905b99e1>静态注册开发流程</a><ul class="level3" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#在java中定义native方法" data-v-905b99e1>在java中定义native方法</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#编写c语言源码-c向java返回字符串" data-v-905b99e1>编写c语言源码 C向Java返回字符串</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#通过cmake打包" data-v-905b99e1>通过Cmake打包</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#在java层声明so文件" data-v-905b99e1>在java层声明so文件</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#静态注册下c调用java的普通字段与静态字段" data-v-905b99e1>静态注册下C调用Java的普通字段与静态字段</a><ul class="level3" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#普通字段" data-v-905b99e1>普通字段</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#静态字段" data-v-905b99e1>静态字段</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#静态注册下c调用java的普通方法与静态方法" data-v-905b99e1>静态注册下C调用Java的普通方法与静态方法</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#动态注册开发流程" data-v-905b99e1>动态注册开发流程</a><ul class="level3" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#在java中定义native方法-1" data-v-905b99e1>在java中定义native方法</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#编写c语言源码" data-v-905b99e1>编写c语言源码</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#通过cmake打包-1" data-v-905b99e1>通过Cmake打包</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#在java层声明so文件-1" data-v-905b99e1>在java层声明so文件</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#静态注册与动态注册的优缺点" data-v-905b99e1>静态注册与动态注册的优缺点</a><ul class="level3" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#静态注册缺点" data-v-905b99e1>静态注册缺点</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#动态注册优点" data-v-905b99e1>动态注册优点</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></li><!--]--></ul></section></div><div class="sidebar_bottom card_border" data-v-e01a06ce><div class="avatar" style="background-image:url(/assets/imgs/avatar.jpg);" data-v-e01a06ce></div><div class="author" data-v-e01a06ce>Leopold</div><div class="summary" data-v-e01a06ce><div data-v-e01a06ce><p data-v-e01a06ce>文章</p></div><div data-v-e01a06ce><p data-v-e01a06ce>分类</p></div><div data-v-e01a06ce><p data-v-e01a06ce>标签</p></div><div data-v-e01a06ce><p data-v-e01a06ce>17</p></div><div data-v-e01a06ce><p data-v-e01a06ce>9</p></div><div data-v-e01a06ce><p data-v-e01a06ce>28</p></div></div><div class="connection" data-v-e01a06ce><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M1023.560892 524.587752c0 114.331752-32.549236 217.148443-97.647709 308.450075-65.047295 91.301632-149.132822 154.455339-252.205404 189.512299-11.975662 2.303012-20.778286 0.716493-26.305515-4.759558a27.584966 27.584966 0 0 1-8.342021-20.471218V853.150798c0-44.166653-11.566238-76.511177-34.647536-96.982394a446.272549 446.272549 0 0 0 68.32269-12.282731c20.16415-5.476051 41.044792-14.329852 62.590748-26.612583a187.311643 187.311643 0 0 0 53.992837-45.446104c14.432209-18.014672 26.203159-41.914819 35.312851-71.751618 9.109692-29.8368 13.664538-64.074912 13.664538-102.765514 0-55.118754-17.554069-102.049021-52.61103-140.739623 16.376974-41.454216 14.636921-87.872703-5.373695-139.357815-12.436265-4.094244-30.399759-1.535341-53.941659 7.523172a355.17563 355.17563 0 0 0-61.311297 30.041513l-25.333132 16.376974a462.137743 462.137743 0 0 0-127.945112-17.707604 462.137743 462.137743 0 0 0-127.945111 17.758782 589.571074 589.571074 0 0 0-28.301459-18.424096c-11.77095-7.31846-30.34858-16.069906-55.681713-26.305515-25.281954-10.235609-44.422543-13.306292-57.31941-9.212048-19.498835 51.433935-21.085354 97.852421-4.606024 139.306637-35.108139 38.690602-52.713386 85.620869-52.713386 140.739623 0 38.690602 4.606024 72.826357 13.715716 102.458445 9.109692 29.58091 20.778286 53.481057 34.954605 71.700441a180.658498 180.658498 0 0 0 53.634591 45.753172c21.545957 12.282731 42.477777 21.18771 62.641926 26.612583 20.215328 5.527229 42.989557 9.621472 68.32269 12.333909-17.758781 16.376974-28.659705 39.867697-32.651593 70.369811a129.941055 129.941055 0 0 1-29.990334 10.235609 184.087426 184.087426 0 0 1-37.974109 3.428929c-14.688099 0-29.171485-4.913092-43.654872-14.688099-14.432209-9.826185-26.766117-24.053681-37.001726-42.682489a109.162769 109.162769 0 0 0-32.293346-35.517563c-13.101579-9.109692-24.104859-14.585743-33.009839-16.376974l-13.306292-2.047122c-9.314404 0-15.762838 1.023561-19.345301 3.070683-3.582463 2.047122-4.606024 4.606024-3.326572 7.83024a37.769397 37.769397 0 0 0 5.987831 9.570295 49.182101 49.182101 0 0 0 8.700267 8.188487l4.606024 3.377751c9.826185 4.606024 19.447657 13.255114 29.017952 25.998447 9.570294 12.743333 16.581686 24.360749 20.982998 34.80107l6.653146 15.71166c5.783119 17.298179 15.558126 31.320963 29.376197 42.017174 13.766894 10.747389 28.659705 17.554069 44.627255 20.471218 15.96755 2.968327 31.423319 4.606024 46.316131 4.810736 14.841633 0.204712 27.22672-0.562958 37.001726-2.405368l15.302235-2.712436c0 17.298179 0.102356 37.564685 0.358247 60.799517l0.307068 36.848192c0 8.188487-2.86597 15.046345-8.700268 20.471218-5.731941 5.527229-14.636921 7.113748-26.612583 4.810736-103.072582-35.056961-187.158109-98.261846-252.205404-189.512299C32.549236 741.736195 0 638.919504 0 524.587752c0-95.191163 22.876586-182.910331 68.629758-263.31104a516.028224 516.028224 0 0 1 186.288082-190.894106A491.309228 491.309228 0 0 1 511.780446 0.012795a491.309228 491.309228 0 0 1 256.913784 70.369811 516.028224 516.028224 0 0 1 186.236905 190.894106C1000.684306 341.626242 1023.560892 429.447767 1023.560892 524.587752z"></path></svg></div><div data-v-e01a06ce><span data-v-e01a06ce>github.com/SayNop</span></div><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z"></path></svg></div><div data-v-e01a06ce><span data-v-e01a06ce>gitee.com/WhenTimeGoesBy</span></div><!-- <div class="grid_icon"><mail_icon class="icon" /></div><div><span @click="open_link(themeData.connection_link.mail)">{{ themeData.connection_link.mail }}</span></div> --><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M874.666667 181.333333H149.333333c-40.533333 0-74.666667 34.133333-74.666666 74.666667v512c0 40.533333 34.133333 74.666667 74.666666 74.666667h725.333334c40.533333 0 74.666667-34.133333 74.666666-74.666667V256c0-40.533333-34.133333-74.666667-74.666666-74.666667z m-725.333334 64h725.333334c6.4 0 10.666667 4.266667 10.666666 10.666667v25.6L512 516.266667l-373.333333-234.666667V256c0-6.4 4.266667-10.666667 10.666666-10.666667z m725.333334 533.333334H149.333333c-6.4 0-10.666667-4.266667-10.666666-10.666667V356.266667l356.266666 224c4.266667 4.266667 10.666667 4.266667 17.066667 4.266666s12.8-2.133333 17.066667-4.266666l356.266666-224V768c0 6.4-4.266667 10.666667-10.666666 10.666667z"></path></svg></div><div data-v-e01a06ce><a href="mailto:fur999immer@gmail.com" data-v-e01a06ce>fur999immer@gmail.com</a></div></div></div></div></div><div class="content_container"><!--[--><div class="card_border article_container" data-v-77edf713><div class="frontmatter_info" data-v-77edf713><h1 data-v-77edf713>安卓NDK开发</h1><div data-v-77edf713>2023-05-05</div><div class="card_tag frontmatter_tags" data-v-77edf713><span class="icon" data-v-77edf713><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-77edf713><path d="M896 682.666667a42.666667 42.666667 0 0 0-42.666667-42.666667h-85.333333v-85.333333a85.333333 85.333333 0 0 0-85.333333-85.333334h-128V384h85.333333a42.666667 42.666667 0 0 0 42.666667-42.666667V170.666667a42.666667 42.666667 0 0 0-42.666667-42.666667H384a42.666667 42.666667 0 0 0-42.666667 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666667 42.666667h85.333333v85.333333H341.333333a85.333333 85.333333 0 0 0-85.333333 85.333334v85.333333H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666667 42.666667h256a42.666667 42.666667 0 0 0 42.666666-42.666667v-170.666666a42.666667 42.666667 0 0 0-42.666666-42.666667H341.333333v-85.333333h341.333334v85.333333h-85.333334a42.666667 42.666667 0 0 0-42.666666 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666666 42.666667h256a42.666667 42.666667 0 0 0 42.666667-42.666667z"></path></svg></span><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_category" data-v-77edf713 data-v-c2920afd>Android</span><!--]--><span class="icon" style="margin-right:5px;" data-v-77edf713><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-77edf713><path d="M985.6 473.6 985.6 473.6l-256 256-256 256 0 0C454.4 1011.2 422.4 1024 384 1024c-38.4 0-70.4-12.8-89.6-38.4l0 0-256-256 0 0C12.8 710.4 0 678.4 0 640c0-38.4 12.8-70.4 38.4-89.6l0 0 256-256 256-256 0 0C569.6 12.8 601.6 0 640 0l256 0c70.4 0 128 57.6 128 128l0 256C1024 422.4 1011.2 454.4 985.6 473.6zM768 128c-70.4 0-128 57.6-128 128 0 70.4 57.6 128 128 128 70.4 0 128-57.6 128-128C896 185.6 838.4 128 768 128z"></path></svg></span><!--[--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>Android</span><!--]--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>Ndk</span><!--]--><!--]--></div></div><div data-v-77edf713><h2 id="静态注册开发流程" tabindex="-1"><a class="header-anchor" href="#静态注册开发流程" aria-hidden="true">#</a> 静态注册开发流程</h2><p>以java层获取C层返回字符串为例的安卓应用开发流程</p><h3 id="在java中定义native方法" tabindex="-1"><a class="header-anchor" href="#在java中定义native方法" aria-hidden="true">#</a> 在java中定义native方法</h3><p>参考以下例子编写java层的类，在类中定义需要通过c语言实现的native方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>testndk</span><span class="token punctuation">;</span>
  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 弹窗显示出native函数调用结果</span>
        <span class="token comment">// 第一个参数是上下文，这里直接传入this</span>
        <span class="token comment">// 第二个参数是显示内容，这里直接调用jni函数，打印函数返回值</span>
        <span class="token comment">// 第三个参数是弹窗时间</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getstring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token constant">LENGTH_LONG</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token comment">// native方法的定义 - 从c层得到返回字段</span>
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token class-name">CharSequence</span> <span class="token function">getstring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编写c语言源码-c向java返回字符串" tabindex="-1"><a class="header-anchor" href="#编写c语言源码-c向java返回字符串" aria-hidden="true">#</a> 编写c语言源码 C向Java返回字符串</h3><ul><li>在安卓项目目录的 <em>src</em> 文件夹下，使用命令<code>javah -jni com.example.testndk.MainActivity</code> <em>生成 JNI 样式的标头文件 (默认值)</em> 。其中，说明文字是<code>javah</code>中的说明，<code>com.example.testndk.MainActivity</code>是native函数所在类的路径。此时在 <em>src</em> 下生成了名为 <em>com.example.testndk.h</em> 的头文件。</li><li>在项目目录下创建文件夹 <em>jni</em> （与 <em>src</em> 文件夹同级）。将生成的 <em>com.example.testndk.h</em> 改名为 <em>JNI_study.h</em> ，并移动到 <em>jni</em> 文件夹内。</li><li>在 <em>jni</em> 文件夹内创建同名的 <em>JNI_study.c</em> 文件并编写ndk函数</li></ul><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;JNI_study.h&quot;</span>  <span class="token comment">// 调用生成的库文件</span></span>

<span class="token comment">// 返回指定字段</span>
<span class="token comment">// 函数名直接从生成的JNI_study.h中复制，并按规定补全固定的形参</span>
JNIEXPORT jobject JNICALL <span class="token function">Java_example_testndk_MainActivity_getstring</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token comment">// 在jni.h中搜索并复制出NewStringUTF，参考定义传入指定参数，从c层将数据返回java层</span>
  	<span class="token comment">// 使用搜索第一次出现的结果，第一次是c语言接口，后续出现的是c++接口</span>
    <span class="token comment">// jstring     (*NewStringUTF)(JNIEnv*, const char*);</span>
  	jstring str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">NewStringUTF</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>通过 <em>jni.h</em> 中定义的api将so中的值返回给java</li></ul><p><strong>说明：</strong></p><p><code>env</code>为结构体指针，<code>(*env)</code>为结构体实例，<code>(*env) -&gt; NewStringUTF</code>表明调用结构体的<code>NewStringUTF</code></p><h3 id="通过cmake打包" tabindex="-1"><a class="header-anchor" href="#通过cmake打包" aria-hidden="true">#</a> 通过Cmake打包</h3><ul><li>在 <em>jni</em> 文件夹内编写android mk文件 <em>Android.mk</em></li></ul><div class="language-makefile line-numbers-mode" data-ext="makefile"><pre class="language-makefile"><code>LOCAL_PATH <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">call</span> my-dir<span class="token punctuation">)</span>
<span class="token keyword">include</span> <span class="token variable">$</span><span class="token punctuation">(</span>CLEAR_VARS<span class="token punctuation">)</span>
LOCAL_MODULE <span class="token operator">:=</span> JNI_study  <span class="token comment"># 模块名，即头文件&#39;.h&#39;前的文件名</span>
LOCAL_SRC_FILES <span class="token operator">:=</span> JNI_study.c  <span class="token comment"># 源文件 .c/.cpp</span>
LOCAL_ARM_MODE <span class="token operator">:=</span> arm  <span class="token comment"># 编译后的指令集 ARM指令集</span>
LOCAL_LDLIBS <span class="token operator">+=</span> -llog  <span class="token comment"># 依赖库</span>
<span class="token keyword">include</span> <span class="token variable">$</span><span class="token punctuation">(</span>BULID_SHARED_LIBRARY<span class="token punctuation">)</span>  <span class="token comment"># 指定编译文件的类型</span>
<span class="token comment"># 编译可执行文件 $(BULID_EXECUTABLE)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在 <em>jni</em> 文件夹内编写android mk文件 <em>Application.mk</em></li></ul><div class="language-makefile line-numbers-mode" data-ext="makefile"><pre class="language-makefile"><code>APP_API <span class="token operator">:=</span> armeabi-v7a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>在 <em>jni</em> 文件夹执行命令<code>ndk-build</code>，在项目目录下生成<code>libs/arm/libJNI_study.so</code></li></ul><h3 id="在java层声明so文件" tabindex="-1"><a class="header-anchor" href="#在java层声明so文件" aria-hidden="true">#</a> 在java层声明so文件</h3><p>将android mk文件中的模块名称作为导入名 (so文件去头去尾：libJNI_study.so -&gt; JNI_study) 进行导入</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>testndk</span><span class="token punctuation">;</span>
  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
    <span class="token comment">// 声明导入的模块</span>
    <span class="token keyword">static</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">&quot;JNI_study&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getstring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token constant">LENGTH_LONG</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token class-name">CharSequence</span> <span class="token function">getstring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="静态注册下c调用java的普通字段与静态字段" tabindex="-1"><a class="header-anchor" href="#静态注册下c调用java的普通字段与静态字段" aria-hidden="true">#</a> 静态注册下C调用Java的普通字段与静态字段</h2><p>在java层定义普通字段与静态字段，和native方法声明</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>testndk</span><span class="token punctuation">;</span>
  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
  	<span class="token comment">// java层的普通字段与静态字段</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;Normal String&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token string">&quot;Static String&quot;</span><span class="token punctuation">;</span>
  
    <span class="token keyword">static</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">&quot;JNI_study&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getNormalString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getStaticString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// native函数声明 - 从java层得到字段</span>
    <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token class-name">CharSequence</span> <span class="token function">getNormalString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token class-name">CharSequence</span> <span class="token function">getStaticString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="普通字段" tabindex="-1"><a class="header-anchor" href="#普通字段" aria-hidden="true">#</a> 普通字段</h3><p>生成<code>javah</code>头文件并根据头文件编写c语言源码。从下往上，缺啥补啥。</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;JNI_study.h&quot;</span></span>

<span class="token comment">// 获取java层普通字段</span>
JNIEXPORT jobject JNICALL <span class="token function">Java_example_testndk_MainActivity_getNormalString</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token comment">// 在jni.h中搜索并复制出getObjectField，参考定义传入指定参数，从java层获取字段</span>
    <span class="token comment">// jobject     (*GetObjectField)(JNIEnv*, jobject, jfieldID);</span>
  	<span class="token comment">// 获取字段id需要用到接口</span>
  	<span class="token comment">// jfieldID    (*GetFieldID)(JNIEnv*, jclass, const char*, const char*);</span>
  	<span class="token comment">// GetFieldID第二个参数jclass 需要用到接口FindClass指明字段所在类</span>
    <span class="token comment">// jclass      (*FindClass)(JNIEnv*, const char*); 字符串为类的相对路径，即包+类名的&#39;.&#39;换成&#39;/&#39;</span>
    jclass j_class <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">FindClass</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token string">&quot;com/example/testndk/MainActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	  <span class="token comment">// GetFieldID后两个参数，第一个为java层字段变量名；第二个为返回值的签名，即smali的类型（&#39;.&#39;改成&#39;/&#39;，字符&#39;L&#39;开头，并加上&#39;;&#39;）</span>
    jfieldID j_fieldID <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">GetFieldID</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> j_class<span class="token punctuation">,</span> <span class="token string">&quot;str1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Ljava/lang/String;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	jobject str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">GetObjectField</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> j_fieldID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="静态字段" tabindex="-1"><a class="header-anchor" href="#静态字段" aria-hidden="true">#</a> 静态字段</h3><p>生成<code>javah</code>头文件并根据头文件编写c语言源码。从下往上，缺啥补啥。先缺jfieldID，后缺jclass</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;JNI_study.h&quot;</span></span>

<span class="token comment">// 获取java层静态字段</span>
JNIEXPORT jobject JNICALL <span class="token function">Java_example_testndk_MainActivity_getStaticString</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token comment">// 在jni.h中搜索并复制出GetStaticObjectField，参考定义传入指定参数，从java层获取字段</span>
    <span class="token comment">// jobject     (*GetStaticObjectField)(JNIEnv*, jclass, jfieldID);</span>
  	<span class="token comment">// 需要获取java类和java静态字段id</span>
  	jclass j_class <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">FindClass</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token string">&quot;com/example/testndk/MainActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// jfieldID    (*GetStaticFieldID)(JNIEnv*, jclass, const char*, const char*);</span>
    <span class="token comment">// GetStaticFieldID 后两个参数，第一个为java层字段变量名；第二个为返回值的签名，即smali的类型（&#39;.&#39;改成&#39;/&#39;，字符&#39;L&#39;开头，并加上&#39;;&#39;）</span>
    jfieldID j_fieldID <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">GetStaticFieldID</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> j_class<span class="token punctuation">,</span> <span class="token string">&quot;str2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Ljava/lang/String;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  	jobject str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">GetStaticObjectField</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> j_class<span class="token punctuation">,</span> j_fieldID<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="静态注册下c调用java的普通方法与静态方法" tabindex="-1"><a class="header-anchor" href="#静态注册下c调用java的普通方法与静态方法" aria-hidden="true">#</a> 静态注册下C调用Java的普通方法与静态方法</h2><ul><li>在java层定义普通字段与静态字段，和native方法声明</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>testndk</span><span class="token punctuation">;</span>
  
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>  
    <span class="token keyword">static</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">&quot;JNI_study&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 静态方法中的toast需要上下文，静态方法不能用this</span>
        context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用native函数</span>
        <span class="token function">getJavaMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// java层的普通方法</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;Normal Method&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// java层的静态方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// static 静态方法获取上下文不能用this</span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token string">&quot;Static Method&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token comment">// native函数声明</span>
    <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token class-name">String</span> <span class="token function">getJavaMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>生成<code>javah</code>头文件并根据头文件编写c语言源码。从下往上，缺啥补啥。先缺jfieldID，后缺jclass</li></ul><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;JNI_study.h&quot;</span></span>

<span class="token comment">// 调用java层普通方法与静态方法</span>
JNIEXPORT jstring JNICALL <span class="token function">Java_example_testndk_MainActivity_getNormalMethod</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ************调用java层普通方法************</span>
    <span class="token comment">// 获取java类</span>
    jclass j_class <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">FindClass</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token string">&quot;com/example/testndk/MainActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	
    <span class="token comment">// 获取方法id</span>
    <span class="token comment">//jmethodID   (*GetMethodID)(JNIEnv*, jclass, const char*, const char*);缺失class参数</span>
    <span class="token comment">// 第三个参数为java方法名，第四个参数是入参出参签名(例如：&quot;(Ljava/lang/String;)Ljava/lang/String;&quot;)</span>
    jmethodID method1_id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">GetMethodID</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> j_class<span class="token punctuation">,</span> <span class="token string">&quot;method1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;()V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
    <span class="token comment">// **调用java层返回空的普通方法，第三个参数为方法id(需要api获取)，后续参数为目标函数的入参</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">CallVoidMethod</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> method1_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  
    <span class="token comment">// ************java层静态方法************</span>
    <span class="token comment">// jmethodID   (*GetStaticMethodID)(JNIEnv*, jclass, const char*, const char*);</span>
    jmethodID method2_id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">GetStaticMethodID</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> j_class<span class="token punctuation">,</span> <span class="token string">&quot;method2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;()V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 调用java层静态方法</span>
    <span class="token comment">// void        (*CallStaticVoidMethod)(JNIEnv*, jclass, jmethodID, ...);</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">CallStaticVoidMethod</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> j_class<span class="token punctuation">,</span> method2_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">// 函数需要jstring返回值 - java函数声明为native String，需要一个string返回值</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">NewStringUTF</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span><span class="token string">&quot;111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>说明：</strong></p><ul><li>由于调用java层返回值为空方法的api<code>CallVoidMethod</code>的返回值一定也为空，所以返回值省略。即<code>void call1 = (*env) -&gt; CallVoidMethod(env, obj, method1_id);</code>省略为<code>(*env) -&gt; CallVoidMethod(env, obj, method1_id);</code>。</li><li>java层方法的入参若为字符串，需要通过jni接口创建java类型的字符串传入函数。<code>str_arg = (*env)-&gt;NewStringUTF(env,&quot;我是java层方法的字符串参数&quot;);</code></li></ul><h2 id="动态注册开发流程" tabindex="-1"><a class="header-anchor" href="#动态注册开发流程" aria-hidden="true">#</a> 动态注册开发流程</h2><h3 id="在java中定义native方法-1" tabindex="-1"><a class="header-anchor" href="#在java中定义native方法-1" aria-hidden="true">#</a> 在java中定义native方法</h3><p>参考以下例子编写一个计算器应用（两个操作数输入框，加减乘除四个操作按钮，toast弹出结果）。在java层的类中定义需要通过c语言实现的native方法</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>calc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
    <span class="token comment">// 第一个操作数</span>
    <span class="token keyword">private</span> <span class="token class-name">EditText</span> num1<span class="token punctuation">;</span>
    <span class="token comment">// 第二个操作数</span>
    <span class="token keyword">private</span> <span class="token class-name">EditText</span> num2<span class="token punctuation">;</span>
    <span class="token comment">// 操作按钮 加、减、乘、除</span>
    <span class="token keyword">private</span> <span class="token class-name">Button</span> add<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Button</span> sub<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Button</span> mul<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Button</span> div<span class="token punctuation">;</span>
    <span class="token comment">// native函数的输入参数</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> arg1<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> arg2<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 控件初始化函数的调用</span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 操作</span>
        <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 控件初始化函数的定义 - 绑定变量与控件</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 绑定操作数据 - 从输入框获取操作数，需要强制类型转换</span>
        <span class="token comment">// R.id.*为布局xml中的id</span>
        num1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>editText1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        num2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>editText2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绑定操作按钮</span>
        add <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sub <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mul <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>mul<span class="token punctuation">)</span><span class="token punctuation">;</span>
        div <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  
    <span class="token comment">// 计算方法</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 监听触发了哪种计算</span>
        <span class="token keyword">final</span> <span class="token class-name">OnClickListener</span> click<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            pubilc <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>add<span class="token operator">:</span>
                      <span class="token comment">// 将输入框内容解析成数字作为传入参数(需要放到监听内动态获取，不然只获取一次)</span>
                      arg1 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num1<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      arg2 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num2<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token comment">// 直接this是setOnClickListener的上下文, 弹出内容需要转换成字符串</span>
                      <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token keyword">break</span>
                  <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>sub<span class="token operator">:</span>
                      arg1 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num1<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      arg2 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num2<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">sub</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token keyword">break</span>
                  <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>mul<span class="token operator">:</span>
                      arg1 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num1<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      arg2 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num2<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">mul</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token keyword">break</span>
                  <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>div<span class="token operator">:</span>
                      arg1 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num1<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      arg2 <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>num2<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">div</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                      <span class="token keyword">break</span>
                  <span class="token keyword">default</span><span class="token operator">:</span>
                      <span class="token keyword">break</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 绑定监听事件</span>
        add <span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>click<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sub <span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>click<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mul <span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>click<span class="token punctuation">)</span><span class="token punctuation">;</span>
        div <span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>click<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// native方法</span>
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">float</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">float</span> arg1<span class="token punctuation">,</span> <span class="token keyword">float</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">float</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">float</span> arg1<span class="token punctuation">,</span> <span class="token keyword">float</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">float</span> <span class="token function">mul</span><span class="token punctuation">(</span><span class="token keyword">float</span> arg1<span class="token punctuation">,</span> <span class="token keyword">float</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">float</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">float</span> arg1<span class="token punctuation">,</span> <span class="token keyword">float</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编写c语言源码" tabindex="-1"><a class="header-anchor" href="#编写c语言源码" aria-hidden="true">#</a> 编写c语言源码</h3><ul><li>在项目目录下创建文件夹 <em>jni</em> （与 <em>src</em> 文件夹同级）。在 <em>jni</em> 文件夹内创建c语言源文件 <em>calcnative.c</em> 文件并编写ndk函数（文件名自定义即可）</li></ul><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;jni.h&gt;</span>  <span class="token comment">// 导入jni接口头文件</span></span>

<span class="token comment">// 加法计算参数, 前两个参数固定， 后续为java层方法参数。函数名无需与java层一样</span>
jfloat <span class="token function">add_c</span><span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span> env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jfloat a<span class="token punctuation">,</span> jfloat b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

jfloat <span class="token function">sub_c</span><span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span> env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jfloat a<span class="token punctuation">,</span> jfloat b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token operator">-</span>b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

jfloat <span class="token function">mul_c</span><span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span> env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jfloat a<span class="token punctuation">,</span> jfloat b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token operator">*</span>b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

jfloat <span class="token function">div_c</span><span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span> env<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jfloat a<span class="token punctuation">,</span> jfloat b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token operator">/</span>b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 动态注册JNINativeMethod结构体 - jni.h中的定义</span>
<span class="token comment">// typedef struct {</span>
<span class="token comment">//     const char* name;  // java方法名</span>
<span class="token comment">//     const char* signature;  // 参数签名</span>
<span class="token comment">//     void*       fnPtr;  // 函数指针fnPtr，指向c层的jni函数</span>
<span class="token comment">// } JNINativeMethod;</span>

<span class="token comment">// 绑定c层的jni函数与java层的native函数的数组，数组名自定义即可</span>
<span class="token comment">// 通过jni.h中的结构体定义数组。</span>
JNINativeMethod nativeMethod<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// java方法名，（参数）签名，void函数指针</span>
    <span class="token punctuation">{</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;(FF)F&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>add_c<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;sub&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;(FF)F&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>sub_c<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;mul&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;(FF)F&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>mul_c<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;(FF)F&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>div_c<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 注册函数，此函数将由JNI_Onload调用 - 自定义名称 - 函数内使用RegisterNatives接口对函数进行注册</span>
<span class="token comment">// jint        (*RegisterNatives)(JNIEnv*, jclass, const JNINativeMethod*, jint);</span>
jint <span class="token function">registerNative</span><span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span> env<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法所在类的相对路径</span>
    jclass j_class <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">FindClass</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token string">&quot;com/example/calc/MainActivity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 需要获取类、数组指针、元素个数, 返回值为注册结果</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>env<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">RegisterNatives</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> j_class<span class="token punctuation">,</span> nativeMethod<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>nativeMethod<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>nativeMethod<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> JNI_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> JNI_ERR<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> JNI_OK<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 编写JNI_Onload进行动态注册，第二个参数为保留参数</span>
<span class="token comment">// **系统自动调用**, 需要返回版本号</span>
JNIEXPORT jint JNICALL <span class="token function">JNI_OnLoad</span><span class="token punctuation">(</span>JavaVM<span class="token operator">*</span> vm<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> reserved<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    JNIEnv<span class="token operator">*</span> env<span class="token punctuation">;</span>
    <span class="token comment">// 获取env用于注册 - vm，env的地址，jni版本号</span>
    <span class="token comment">// jint        (*GetEnv)(JavaVM*, void**, jint);</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>vm<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">GetEnv</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>env<span class="token punctuation">,</span> JNI_VERSION<span class="token punctuation">)</span> <span class="token operator">!=</span> JNI_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取env失败</span>
        <span class="token keyword">return</span> JNI_ERR<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">registerNative</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span> <span class="token operator">!=</span> JNI_OK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 注册失败</span>
        <span class="token keyword">return</span> JNI_ERR<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 全部成功，返回版本号</span>
    <span class="token keyword">return</span> JNI_VERSION<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="通过cmake打包-1" tabindex="-1"><a class="header-anchor" href="#通过cmake打包-1" aria-hidden="true">#</a> 通过Cmake打包</h3><ul><li>在 <em>jni</em> 文件夹内编写android mk文件 <em>Android.mk</em></li></ul><div class="language-makefile line-numbers-mode" data-ext="makefile"><pre class="language-makefile"><code>LOCAL_PATH <span class="token operator">:=</span> <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">call</span> my-dir<span class="token punctuation">)</span>  <span class="token comment"># 返回jni文件路径，便于java导入</span>
<span class="token keyword">include</span> <span class="token variable">$</span><span class="token punctuation">(</span>CLEAR_VARS<span class="token punctuation">)</span>  <span class="token comment"># 清理 LOCAL_PATH 以外，LOCAL 开头的变量，防止全局变量相互影响</span>
LOCAL_MODULE <span class="token operator">:=</span> calcnative  <span class="token comment"># 模块名 - 必须唯一，编译成so，会生成 lib(module).so</span>
LOCAL_SRC_FILES <span class="token operator">:=</span> calcnative.c  <span class="token comment"># 源文件 .c/.cpp</span>
LOCAL_ARM_MODE <span class="token operator">:=</span> arm  <span class="token comment"># 编译后的指令集 ARM指令集</span>
LOCAL_LDLIBS <span class="token operator">+=</span> -llog  <span class="token comment"># 依赖库</span>
<span class="token keyword">include</span> <span class="token variable">$</span><span class="token punctuation">(</span>BULID_SHARED_LIBRARY<span class="token punctuation">)</span>  <span class="token comment"># 指定编译文件的类型 - 此处为动态链接库</span>
<span class="token comment"># 编译可执行文件 $(BULID_EXECUTABLE)</span>
<span class="token comment"># 编译静态链接库 $(BUILD_STATIC_LIBRARY)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在 <em>jni</em> 文件夹内编写android mk文件 <em>Application.mk</em></li></ul><div class="language-makefile line-numbers-mode" data-ext="makefile"><pre class="language-makefile"><code>APP_API <span class="token operator">:=</span> armeabi-v7a
<span class="token comment"># APP_API := x86 armeabi-v7a  # 包含x86</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在 <em>jni</em> 文件夹执行命令<code>ndk-build</code>，在项目目录下生成<code>libs/arm/libcalcnative.so</code></li></ul><h3 id="在java层声明so文件-1" tabindex="-1"><a class="header-anchor" href="#在java层声明so文件-1" aria-hidden="true">#</a> 在java层声明so文件</h3><p>将android mk文件中的模块名称作为导入名 (so文件去头去尾：libJNI_study.so -&gt; JNI_study) 进行导入</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>calc</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span>
    <span class="token comment">// 声明导入的模块</span>
    <span class="token keyword">static</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">&quot;calcnative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="静态注册与动态注册的优缺点" tabindex="-1"><a class="header-anchor" href="#静态注册与动态注册的优缺点" aria-hidden="true">#</a> 静态注册与动态注册的优缺点</h2><h3 id="静态注册缺点" tabindex="-1"><a class="header-anchor" href="#静态注册缺点" aria-hidden="true">#</a> 静态注册缺点</h3><ul><li>编写不方便，jni方法名必须遵守规则且长度无法控制</li><li>过程较多</li><li>运行效率不高，不安全。</li></ul><h3 id="动态注册优点" tabindex="-1"><a class="header-anchor" href="#动态注册优点" aria-hidden="true">#</a> 动态注册优点</h3><ul><li>流程清晰，过程可控</li><li>运行效率高</li></ul></div><div id="comment" class="giscus-wrapper input-top" style="display:block;" data-v-77edf713><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div></div><!--]--><footer class="page_footer" data-v-2c01bf66><div class="footer_middle card_border" data-v-2c01bf66><!--[--><span data-v-2c01bf66>Released under the MIT License. <br data-v-2c01bf66></span><span data-v-2c01bf66>Copyright © 2023-present Leopold <br data-v-2c01bf66></span><!--]--></div></footer></div></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-456349e5.js" defer></script>
  </body>
</html>
