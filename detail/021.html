<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.68">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta property="og:url" content="https://saynop.github.io/detail/021.html"><meta property="og:title" content="JS AST 与 Babel"><meta property="og:description" content="AST，全称抽象语法树（Abstract syntax tree） 环境的安装 npm install @babel/core 在编译原理中，从源码到机器码的过程，中间还需要进过很多步骤。 比如，源码通过词法分析器变为记号序列，再通过语法分析器变为AST，再通过语义分析器，一步步往下编译，最后变成机器码 可以简单理解为将 js 代码，按照规则，解析成一份json数据，通过此json，按照规则，可以还原出 js 代码。此时可以修改 json 中的结构，来解析出新的 js 代码"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Spider"><meta property="article:tag" content="Reverse"><meta property="article:published_time" content="2025-03-15T00:00:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"JS AST 与 Babel","image":[""],"datePublished":"2025-03-15T00:00:00.000Z","dateModified":null,"author":[]}</script><link rel="icon" href="/favicon.ico"><title>JS AST 与 Babel</title><meta name="description" content="AST，全称抽象语法树（Abstract syntax tree） 环境的安装 npm install @babel/core 在编译原理中，从源码到机器码的过程，中间还需要进过很多步骤。 比如，源码通过词法分析器变为记号序列，再通过语法分析器变为AST，再通过语义分析器，一步步往下编译，最后变成机器码 可以简单理解为将 js 代码，按照规则，解析成一份json数据，通过此json，按照规则，可以还原出 js 代码。此时可以修改 json 中的结构，来解析出新的 js 代码">
    <link rel="preload" href="/assets/style-89225919.css" as="style"><link rel="stylesheet" href="/assets/style-89225919.css">
    <link rel="modulepreload" href="/assets/app-101bb220.js"><link rel="modulepreload" href="/assets/021.html-77ffeb7e.js"><link rel="modulepreload" href="/assets/021.html-58600ead.js">
    <link rel="prefetch" href="/assets/index.html-f33fda43.js" as="script"><link rel="prefetch" href="/assets/001.html-12451cc3.js" as="script"><link rel="prefetch" href="/assets/002.html-a6d5828c.js" as="script"><link rel="prefetch" href="/assets/003.html-6c773146.js" as="script"><link rel="prefetch" href="/assets/004.html-689926d8.js" as="script"><link rel="prefetch" href="/assets/005.html-d6b96039.js" as="script"><link rel="prefetch" href="/assets/006.html-5b50a542.js" as="script"><link rel="prefetch" href="/assets/007.html-d3b6ddc8.js" as="script"><link rel="prefetch" href="/assets/008.html-042c4a7a.js" as="script"><link rel="prefetch" href="/assets/009.html-7d1574d7.js" as="script"><link rel="prefetch" href="/assets/010.html-f1724340.js" as="script"><link rel="prefetch" href="/assets/011.html-10672fd1.js" as="script"><link rel="prefetch" href="/assets/012.html-5e7aa08e.js" as="script"><link rel="prefetch" href="/assets/013.html-8dd46ba3.js" as="script"><link rel="prefetch" href="/assets/014.html-d0db391f.js" as="script"><link rel="prefetch" href="/assets/015.html-7a04f43c.js" as="script"><link rel="prefetch" href="/assets/016.html-79bc20a6.js" as="script"><link rel="prefetch" href="/assets/017.html-225b58d3.js" as="script"><link rel="prefetch" href="/assets/018.html-185c4621.js" as="script"><link rel="prefetch" href="/assets/019.html-78c7a739.js" as="script"><link rel="prefetch" href="/assets/020.html-4dd3991a.js" as="script"><link rel="prefetch" href="/assets/404.html-a0fec2a7.js" as="script"><link rel="prefetch" href="/assets/index.html-75381ff5.js" as="script"><link rel="prefetch" href="/assets/index.html-c95ce669.js" as="script"><link rel="prefetch" href="/assets/index.html-2c56dc8e.js" as="script"><link rel="prefetch" href="/assets/index.html-98874abd.js" as="script"><link rel="prefetch" href="/assets/index.html-b2308fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-10e703b4.js" as="script"><link rel="prefetch" href="/assets/index.html-5f3af54d.js" as="script"><link rel="prefetch" href="/assets/index.html-56349a98.js" as="script"><link rel="prefetch" href="/assets/index.html-a7c2713a.js" as="script"><link rel="prefetch" href="/assets/index.html-2e96c3d2.js" as="script"><link rel="prefetch" href="/assets/index.html-9f1eff22.js" as="script"><link rel="prefetch" href="/assets/index.html-16b34053.js" as="script"><link rel="prefetch" href="/assets/index.html-4e233464.js" as="script"><link rel="prefetch" href="/assets/index.html-d90f0ec9.js" as="script"><link rel="prefetch" href="/assets/index.html-3202320f.js" as="script"><link rel="prefetch" href="/assets/index.html-c3fe2c85.js" as="script"><link rel="prefetch" href="/assets/index.html-f3052411.js" as="script"><link rel="prefetch" href="/assets/index.html-5485bfc3.js" as="script"><link rel="prefetch" href="/assets/index.html-a7568890.js" as="script"><link rel="prefetch" href="/assets/index.html-9d25f5f2.js" as="script"><link rel="prefetch" href="/assets/index.html-b9dd3162.js" as="script"><link rel="prefetch" href="/assets/index.html-ff33d682.js" as="script"><link rel="prefetch" href="/assets/index.html-3bce843e.js" as="script"><link rel="prefetch" href="/assets/index.html-09b9da96.js" as="script"><link rel="prefetch" href="/assets/index.html-750acad1.js" as="script"><link rel="prefetch" href="/assets/index.html-1c1e573d.js" as="script"><link rel="prefetch" href="/assets/index.html-8eb4570b.js" as="script"><link rel="prefetch" href="/assets/index.html-7dd1db94.js" as="script"><link rel="prefetch" href="/assets/index.html-32048506.js" as="script"><link rel="prefetch" href="/assets/index.html-a4e9e805.js" as="script"><link rel="prefetch" href="/assets/index.html-df3e534f.js" as="script"><link rel="prefetch" href="/assets/index.html-cb3cc9f5.js" as="script"><link rel="prefetch" href="/assets/index.html-0994fca8.js" as="script"><link rel="prefetch" href="/assets/index.html-a902e771.js" as="script"><link rel="prefetch" href="/assets/index.html-76fbbff6.js" as="script"><link rel="prefetch" href="/assets/index.html-7bc29919.js" as="script"><link rel="prefetch" href="/assets/index.html-2642a77f.js" as="script"><link rel="prefetch" href="/assets/index.html-8dfad283.js" as="script"><link rel="prefetch" href="/assets/index.html-0e75c0da.js" as="script"><link rel="prefetch" href="/assets/index.html-1d59d05d.js" as="script"><link rel="prefetch" href="/assets/index.html-5789a1c9.js" as="script"><link rel="prefetch" href="/assets/index.html-a74daf45.js" as="script"><link rel="prefetch" href="/assets/index.html-12b75b8f.js" as="script"><link rel="prefetch" href="/assets/index.html-b2ab7a90.js" as="script"><link rel="prefetch" href="/assets/001.html-951aa1d5.js" as="script"><link rel="prefetch" href="/assets/002.html-29cee426.js" as="script"><link rel="prefetch" href="/assets/003.html-af79d517.js" as="script"><link rel="prefetch" href="/assets/004.html-df4034f9.js" as="script"><link rel="prefetch" href="/assets/005.html-1ad41c6e.js" as="script"><link rel="prefetch" href="/assets/006.html-acb815b5.js" as="script"><link rel="prefetch" href="/assets/007.html-70f3582e.js" as="script"><link rel="prefetch" href="/assets/008.html-358922d0.js" as="script"><link rel="prefetch" href="/assets/009.html-7faf24be.js" as="script"><link rel="prefetch" href="/assets/010.html-86f09aeb.js" as="script"><link rel="prefetch" href="/assets/011.html-ef9199e5.js" as="script"><link rel="prefetch" href="/assets/012.html-1ba2b184.js" as="script"><link rel="prefetch" href="/assets/013.html-c4d7cd84.js" as="script"><link rel="prefetch" href="/assets/014.html-79d16834.js" as="script"><link rel="prefetch" href="/assets/015.html-14b1dc76.js" as="script"><link rel="prefetch" href="/assets/016.html-7c5a4d20.js" as="script"><link rel="prefetch" href="/assets/017.html-cb5df78e.js" as="script"><link rel="prefetch" href="/assets/018.html-a5cc1730.js" as="script"><link rel="prefetch" href="/assets/019.html-c29facde.js" as="script"><link rel="prefetch" href="/assets/020.html-b8cf5b75.js" as="script"><link rel="prefetch" href="/assets/404.html-106e0ea6.js" as="script"><link rel="prefetch" href="/assets/index.html-ffa0d197.js" as="script"><link rel="prefetch" href="/assets/index.html-0a590154.js" as="script"><link rel="prefetch" href="/assets/index.html-bdbffe49.js" as="script"><link rel="prefetch" href="/assets/index.html-2a32793d.js" as="script"><link rel="prefetch" href="/assets/index.html-122a2d96.js" as="script"><link rel="prefetch" href="/assets/index.html-27c4c7b8.js" as="script"><link rel="prefetch" href="/assets/index.html-374807a3.js" as="script"><link rel="prefetch" href="/assets/index.html-040a12ac.js" as="script"><link rel="prefetch" href="/assets/index.html-00a549f5.js" as="script"><link rel="prefetch" href="/assets/index.html-770d9f6e.js" as="script"><link rel="prefetch" href="/assets/index.html-704e065c.js" as="script"><link rel="prefetch" href="/assets/index.html-50a41a7b.js" as="script"><link rel="prefetch" href="/assets/index.html-8a221954.js" as="script"><link rel="prefetch" href="/assets/index.html-b264b1c4.js" as="script"><link rel="prefetch" href="/assets/index.html-e780e857.js" as="script"><link rel="prefetch" href="/assets/index.html-b50d5845.js" as="script"><link rel="prefetch" href="/assets/index.html-567982f2.js" as="script"><link rel="prefetch" href="/assets/index.html-56c7e37f.js" as="script"><link rel="prefetch" href="/assets/index.html-885e6622.js" as="script"><link rel="prefetch" href="/assets/index.html-0d1a8961.js" as="script"><link rel="prefetch" href="/assets/index.html-b18fa44c.js" as="script"><link rel="prefetch" href="/assets/index.html-b91c839f.js" as="script"><link rel="prefetch" href="/assets/index.html-b7ac3d4e.js" as="script"><link rel="prefetch" href="/assets/index.html-682304be.js" as="script"><link rel="prefetch" href="/assets/index.html-8560dbcb.js" as="script"><link rel="prefetch" href="/assets/index.html-d91485b9.js" as="script"><link rel="prefetch" href="/assets/index.html-82451a06.js" as="script"><link rel="prefetch" href="/assets/index.html-df4b0413.js" as="script"><link rel="prefetch" href="/assets/index.html-39ddd48f.js" as="script"><link rel="prefetch" href="/assets/index.html-efb50a21.js" as="script"><link rel="prefetch" href="/assets/index.html-5a128c0b.js" as="script"><link rel="prefetch" href="/assets/index.html-ee99b72a.js" as="script"><link rel="prefetch" href="/assets/index.html-8291c8ac.js" as="script"><link rel="prefetch" href="/assets/index.html-8505e1ce.js" as="script"><link rel="prefetch" href="/assets/index.html-9fd54cc3.js" as="script"><link rel="prefetch" href="/assets/index.html-0607c7ec.js" as="script"><link rel="prefetch" href="/assets/index.html-51ac1d9b.js" as="script"><link rel="prefetch" href="/assets/index.html-3ccb9e58.js" as="script"><link rel="prefetch" href="/assets/index.html-3ecf194f.js" as="script"><link rel="prefetch" href="/assets/index.html-050b2b9a.js" as="script"><link rel="prefetch" href="/assets/index.html-37748b1e.js" as="script"><link rel="prefetch" href="/assets/index.html-e0c8825d.js" as="script"><link rel="prefetch" href="/assets/index.html-45fd2a32.js" as="script"><link rel="prefetch" href="/assets/giscus-0b7adcf8.js" as="script"><link rel="prefetch" href="/assets/SearchResult-f0d10221.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div data-v-77edf713><header class="header" style="opacity:0;" data-v-90176301><div class="header_container" data-v-90176301><div data-v-90176301><a class="header_title" href="/" data-v-90176301>Leopold&#39;s Blog</a></div><div class="appearance" data-v-90176301><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><!----></button><!--]--><button class="switch" data-v-90176301><span class="icon" style="display:block;" data-v-90176301><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" style="" data-v-90176301><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" style="display:none;" data-v-90176301><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></button><button class="switch mobile_list_btn" type="button" data-v-90176301><span class="btn_top" data-v-90176301></span><span class="btn_middle" data-v-90176301></span><span class="btn_bottom" data-v-90176301></span></button></div></div></header><div class="main"><div class="background" data-v-fee8de4c><svg class="pull_down" viewbox="0 0 1026 1024" xmlns="http://www.w3.org/2000/svg" data-v-fee8de4c data-v-3c8412b0><path d="M857.088 224.256q28.672-28.672 69.12-28.672t69.12 28.672q29.696 28.672 29.696 68.608t-29.696 68.608l-382.976 380.928q-12.288 14.336-30.72 19.968t-38.912 4.608-40.448-8.704-34.304-22.016l-376.832-374.784q-29.696-28.672-29.696-68.608t29.696-68.608q14.336-14.336 32.256-21.504t36.864-7.168 37.376 7.168 32.768 21.504l313.344 309.248z" data-v-3c8412b0></path></svg></div><div style="display:flex;"><div class="sider_keeper" data-v-e01a06ce><div class="folding" data-v-e01a06ce><!-- <div class="folding"> --><div class="sidebar_top card_border" style="min-height:1rem" data-v-e01a06ce><div class="tags_brand" data-v-e01a06ce>本文大纲</div><section class="article_sidebar" data-v-e01a06ce data-v-905b99e1><ul data-v-905b99e1><!--[--><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#了解ast结构" data-v-905b99e1>了解AST结构</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#babel-api-简介" data-v-905b99e1>babel api 简介</a><ul class="level3" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#常用代码结构" data-v-905b99e1>常用代码结构</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#parser" data-v-905b99e1>parser</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#generator" data-v-905b99e1>generator</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#traverse" data-v-905b99e1>traverse</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#types" data-v-905b99e1>types</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#path" data-v-905b99e1>Path</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#scope" data-v-905b99e1>scope</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></li><!--]--></ul></section></div><div class="sidebar_bottom card_border" data-v-e01a06ce><div class="avatar" style="background-image:url(/assets/imgs/avatar.jpg);" data-v-e01a06ce></div><div class="author" data-v-e01a06ce>Leopold</div><div class="summary" data-v-e01a06ce><div data-v-e01a06ce><p data-v-e01a06ce>文章</p></div><div data-v-e01a06ce><p data-v-e01a06ce>分类</p></div><div data-v-e01a06ce><p data-v-e01a06ce>标签</p></div><div data-v-e01a06ce><p data-v-e01a06ce>21</p></div><div data-v-e01a06ce><p data-v-e01a06ce>10</p></div><div data-v-e01a06ce><p data-v-e01a06ce>31</p></div></div><div class="connection" data-v-e01a06ce><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M1023.560892 524.587752c0 114.331752-32.549236 217.148443-97.647709 308.450075-65.047295 91.301632-149.132822 154.455339-252.205404 189.512299-11.975662 2.303012-20.778286 0.716493-26.305515-4.759558a27.584966 27.584966 0 0 1-8.342021-20.471218V853.150798c0-44.166653-11.566238-76.511177-34.647536-96.982394a446.272549 446.272549 0 0 0 68.32269-12.282731c20.16415-5.476051 41.044792-14.329852 62.590748-26.612583a187.311643 187.311643 0 0 0 53.992837-45.446104c14.432209-18.014672 26.203159-41.914819 35.312851-71.751618 9.109692-29.8368 13.664538-64.074912 13.664538-102.765514 0-55.118754-17.554069-102.049021-52.61103-140.739623 16.376974-41.454216 14.636921-87.872703-5.373695-139.357815-12.436265-4.094244-30.399759-1.535341-53.941659 7.523172a355.17563 355.17563 0 0 0-61.311297 30.041513l-25.333132 16.376974a462.137743 462.137743 0 0 0-127.945112-17.707604 462.137743 462.137743 0 0 0-127.945111 17.758782 589.571074 589.571074 0 0 0-28.301459-18.424096c-11.77095-7.31846-30.34858-16.069906-55.681713-26.305515-25.281954-10.235609-44.422543-13.306292-57.31941-9.212048-19.498835 51.433935-21.085354 97.852421-4.606024 139.306637-35.108139 38.690602-52.713386 85.620869-52.713386 140.739623 0 38.690602 4.606024 72.826357 13.715716 102.458445 9.109692 29.58091 20.778286 53.481057 34.954605 71.700441a180.658498 180.658498 0 0 0 53.634591 45.753172c21.545957 12.282731 42.477777 21.18771 62.641926 26.612583 20.215328 5.527229 42.989557 9.621472 68.32269 12.333909-17.758781 16.376974-28.659705 39.867697-32.651593 70.369811a129.941055 129.941055 0 0 1-29.990334 10.235609 184.087426 184.087426 0 0 1-37.974109 3.428929c-14.688099 0-29.171485-4.913092-43.654872-14.688099-14.432209-9.826185-26.766117-24.053681-37.001726-42.682489a109.162769 109.162769 0 0 0-32.293346-35.517563c-13.101579-9.109692-24.104859-14.585743-33.009839-16.376974l-13.306292-2.047122c-9.314404 0-15.762838 1.023561-19.345301 3.070683-3.582463 2.047122-4.606024 4.606024-3.326572 7.83024a37.769397 37.769397 0 0 0 5.987831 9.570295 49.182101 49.182101 0 0 0 8.700267 8.188487l4.606024 3.377751c9.826185 4.606024 19.447657 13.255114 29.017952 25.998447 9.570294 12.743333 16.581686 24.360749 20.982998 34.80107l6.653146 15.71166c5.783119 17.298179 15.558126 31.320963 29.376197 42.017174 13.766894 10.747389 28.659705 17.554069 44.627255 20.471218 15.96755 2.968327 31.423319 4.606024 46.316131 4.810736 14.841633 0.204712 27.22672-0.562958 37.001726-2.405368l15.302235-2.712436c0 17.298179 0.102356 37.564685 0.358247 60.799517l0.307068 36.848192c0 8.188487-2.86597 15.046345-8.700268 20.471218-5.731941 5.527229-14.636921 7.113748-26.612583 4.810736-103.072582-35.056961-187.158109-98.261846-252.205404-189.512299C32.549236 741.736195 0 638.919504 0 524.587752c0-95.191163 22.876586-182.910331 68.629758-263.31104a516.028224 516.028224 0 0 1 186.288082-190.894106A491.309228 491.309228 0 0 1 511.780446 0.012795a491.309228 491.309228 0 0 1 256.913784 70.369811 516.028224 516.028224 0 0 1 186.236905 190.894106C1000.684306 341.626242 1023.560892 429.447767 1023.560892 524.587752z"></path></svg></div><div data-v-e01a06ce><span data-v-e01a06ce>github.com/SayNop</span></div><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z"></path></svg></div><div data-v-e01a06ce><span data-v-e01a06ce>gitee.com/WhenTimeGoesBy</span></div><!-- <div class="grid_icon"><mail_icon class="icon" /></div><div><span @click="open_link(themeData.connection_link.mail)">{{ themeData.connection_link.mail }}</span></div> --><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M874.666667 181.333333H149.333333c-40.533333 0-74.666667 34.133333-74.666666 74.666667v512c0 40.533333 34.133333 74.666667 74.666666 74.666667h725.333334c40.533333 0 74.666667-34.133333 74.666666-74.666667V256c0-40.533333-34.133333-74.666667-74.666666-74.666667z m-725.333334 64h725.333334c6.4 0 10.666667 4.266667 10.666666 10.666667v25.6L512 516.266667l-373.333333-234.666667V256c0-6.4 4.266667-10.666667 10.666666-10.666667z m725.333334 533.333334H149.333333c-6.4 0-10.666667-4.266667-10.666666-10.666667V356.266667l356.266666 224c4.266667 4.266667 10.666667 4.266667 17.066667 4.266666s12.8-2.133333 17.066667-4.266666l356.266666-224V768c0 6.4-4.266667 10.666667-10.666666 10.666667z"></path></svg></div><div data-v-e01a06ce><a href="mailto:fur999immer@gmail.com" data-v-e01a06ce>fur999immer@gmail.com</a></div></div></div></div></div><div class="content_container"><!--[--><div class="card_border article_container" data-v-77edf713><div class="frontmatter_info" data-v-77edf713><h1 data-v-77edf713>JS AST 与 Babel</h1><div data-v-77edf713>2025-03-15</div><div class="card_tag frontmatter_tags" data-v-77edf713><span class="icon" data-v-77edf713><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-77edf713><path d="M896 682.666667a42.666667 42.666667 0 0 0-42.666667-42.666667h-85.333333v-85.333333a85.333333 85.333333 0 0 0-85.333333-85.333334h-128V384h85.333333a42.666667 42.666667 0 0 0 42.666667-42.666667V170.666667a42.666667 42.666667 0 0 0-42.666667-42.666667H384a42.666667 42.666667 0 0 0-42.666667 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666667 42.666667h85.333333v85.333333H341.333333a85.333333 85.333333 0 0 0-85.333333 85.333334v85.333333H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666667 42.666667h256a42.666667 42.666667 0 0 0 42.666666-42.666667v-170.666666a42.666667 42.666667 0 0 0-42.666666-42.666667H341.333333v-85.333333h341.333334v85.333333h-85.333334a42.666667 42.666667 0 0 0-42.666666 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666666 42.666667h256a42.666667 42.666667 0 0 0 42.666667-42.666667z"></path></svg></span><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_category" data-v-77edf713 data-v-c2920afd>Spider</span><!--]--><span class="icon" style="margin-right:5px;" data-v-77edf713><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-77edf713><path d="M985.6 473.6 985.6 473.6l-256 256-256 256 0 0C454.4 1011.2 422.4 1024 384 1024c-38.4 0-70.4-12.8-89.6-38.4l0 0-256-256 0 0C12.8 710.4 0 678.4 0 640c0-38.4 12.8-70.4 38.4-89.6l0 0 256-256 256-256 0 0C569.6 12.8 601.6 0 640 0l256 0c70.4 0 128 57.6 128 128l0 256C1024 422.4 1011.2 454.4 985.6 473.6zM768 128c-70.4 0-128 57.6-128 128 0 70.4 57.6 128 128 128 70.4 0 128-57.6 128-128C896 185.6 838.4 128 768 128z"></path></svg></span><!--[--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>Spider</span><!--]--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>Reverse</span><!--]--><!--]--></div></div><div data-v-77edf713><p>AST，全称抽象语法树（Abstract syntax tree）</p><p>环境的安装 <code>npm install @babel/core</code></p><blockquote><p>在编译原理中，从源码到机器码的过程，中间还需要进过很多步骤。</p><p>比如，源码通过词法分析器变为记号序列，再通过语法分析器变为AST，再通过语义分析器，一步步往下编译，最后变成机器码</p></blockquote><p>可以简单理解为将 js 代码，按照规则，解析成一份json数据，通过此json，按照规则，可以还原出 js 代码。此时可以修改 json 中的结构，来解析出新的 js 代码</p><h2 id="了解ast结构" tabindex="-1"><a class="header-anchor" href="#了解ast结构" aria-hidden="true">#</a> 了解AST结构</h2><p>通过解析网站 <a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">https://astexplorer.net/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，选择语言 <em>javascript</em> ，解析引擎 <em>@babel/parser</em>。了解 ast 结构</p><p>下面是一些说明，路径中大写表示该节点的type值，本文会用 type 值来简称这些节点。根节点为 File 节点</p><ul><li><p>代码内容数组（每个语句都是body中的一项） <em>File -&gt; program -&gt; body</em></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// 移除部分信息的结构树</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;File&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Program&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>变量声明</p><ul><li><p>变量声明语句（数组中 type 为 VariableDeclaration 的节点） <em>File -&gt; program -&gt; body[ VariableDeclaration ]</em></p></li><li><p>变量声明类型 <em>File -&gt; program -&gt; body[ VariableDeclaration ] -&gt; kind</em> ，常见取值如 <code>var</code>，<code>let</code>，<code>const</code></p></li><li><p>声明变量数组（声明多个变量 <code>var a,b</code> 的情况存在，因此为数组形式） <em>File -&gt; program -&gt; body[ VariableDeclaration ] -&gt; declarations</em></p></li><li><p>声明变量节点（数组中 type 为 VariableDeclarator 的节点） <em>File -&gt; program -&gt; body[ VariableDeclaration ] -&gt; declarations[ VariableDeclarator ]</em></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// 移除部分信息的结构树</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;File&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;let&quot;</span>
        ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>变量标识符为标识符节点（标识符节点的 type 都为 Identifier，不论变量还是函数） <em>File -&gt; program -&gt; body[ VariableDeclaration ] -&gt; declarations[ VariableDeclarator ] -&gt; id</em></p></li><li><p>变量标识符名 <em>File -&gt; program -&gt; body[ VariableDeclaration ] -&gt; declarations[ VariableDeclarator ] -&gt; id -&gt; name</em> 即 Identifier.name</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
        ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>声明变量初始化赋值节点 声明变量节点 <em>VariableDeclaration -&gt; declarations[ VariableDeclarator ]</em> 存在属性 init。init的值为一个字面量节点（直接写死的值），仅在变量声明时做了初始化才存在 <code>init</code> 属性</p><ul><li><p>数字字面量：init的值为 NumericLiteral 节点，value 为赋值内容</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// b = 1</span>
<span class="token comment">// 省略部分内容</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NumericLiteral&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>字符串字面量：init的值为 StringLiteral 节点，value 为赋值内容</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// let b = &#39;b&#39;</span>
<span class="token comment">// 省略部分内容</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;StringLiteral&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;let&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>箭头函数: init的值为 ArrowFunctionExpression 节点, body 的值为 BlockStatement 节点（该节点在函数中详细说明）。</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ArrowFunctionExpression&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">&quot;generator&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;async&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BlockStatement&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;let&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>数组字面量：ArrayExpression 节点，elements 属性是一个赋值节点数组，用于存放初始化内容。</p><ul><li><p><code>a = []</code>，elements 为空数组</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// let b = []</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ArrayExpression&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;elements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;let&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>a=[1, &#39;a&#39;, function () {}, null, true]</code> elements 为 [ NumericLiteral 节点，StringLiteral 节点，FunctionExpression 节点，BooleanLiteral 节点， NullLiteral 节点 ]</p></li></ul></li></ul></li></ul></li><li><p>特殊的变量：对象</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 声明行</span>
  <span class="token property">&quot;declarations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 声明项</span>
      <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 声明项标识符</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;init&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// 初始化</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ObjectExpression&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 对象表达式 {key : value}</span>
        <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ObjectProperty&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 对象属性</span>
            <span class="token comment">// ...</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// ...</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;let&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>对象声明初始化的属性 <code>init</code> 声明变量节点 <em>VariableDeclaration -&gt; declarations[ VariableDeclarator ]</em> 存在属性 init，init节点的 type 为 ObjectExpression</p></li><li><p>初始化的属性设置数组。ObjectExpression 节点存在属性 <code>properties</code>数组（对象赋值时有多属性赋值情况，因此为数组形式） <em>File -&gt; program -&gt; body[ VariableDeclaration ] -&gt; declarations[ VariableDeclarator ] -&gt; id -&gt; init -&gt; prop</em></p></li><li><p>属性设置节点，即 properties 中的 type 为 ObjectProperty。</p><ul><li><p>对象的属性为数字，如 <code>a = {1:&#39;a&#39;}</code>。ObjectProperty.key 为数字字面量 NumericLiteral 节点，ObjectProperty.value 为字符串字面量节点</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ObjectProperty&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> &quot;NumericLiteral
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;computed&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;shorthand&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;StringLiteral&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>对象属性为字符串，如 <code>a = {b: 1}</code>。ObjectProperty.key 为标识符 Identifier 节点，ObjectProperty.key.name 为属性标识符 <code>&#39;b&#39;</code></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ObjectProperty&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;computed&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;shorthand&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NumericLiteral&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>对象属性值为函数 <code>a = {c: funcion () {}}</code> ObjectProperty.value 为 FunctionExpression 节点</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ObjectProperty&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;computed&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;shorthand&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FunctionExpression&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 函数节点，该节点属性见后续</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;generator&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;async&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BlockStatement&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;directives&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul></li><li><p>表达式</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// var e = 1+2 初始化时的表达式</span>
<span class="token comment">// VariableDeclarator.init 为 BinaryExpression 节点</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BinaryExpression&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;left&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NumericLiteral&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;operator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;right&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NumericLiteral&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// var e; e = 1+2;  独立的表达式</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ExpressionStatement&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AssignmentExpression&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;operator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;left&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;right&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BinaryExpression&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;left&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NumericLiteral&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;operator&quot;</span><span class="token operator">:</span> <span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;right&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NumericLiteral&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>逻辑运算 LogicalExpression ：<code>a &amp;&amp; b</code>, <code>x || y</code></p></li><li><p>三元表达式 ConditionalExpression ：<code>a ? b : c</code></p></li><li><p>二元运算 BinaryExpression <code>a + b</code>, <code>x * y</code></p></li><li><p>一元运算 UnaryExpression：<code>!x</code>, <code>typeof y</code>, <code>-z</code></p></li><li><p>自增/自减 UpdateExpression：<code>i++</code>, <code>--j</code></p></li><li><p>变量赋值（非变量声明初始化） AssignmentExpression ：<code>a = 1</code>, <code>b += 2</code></p></li><li><p>逗号表达式 SequenceExpression，SequenceExpression.expressions 数组用于存放逗号切分的多个内容</p></li><li><p>调用 CallExpression ：<code>foo(1, 2)</code></p></li><li><p>实例化：NewExpression <code>new Person()</code></p></li><li><p>箭头函数：ArrowFunctionExpression ：<code>() =&gt; 42</code></p></li><li><p>函数表达式：FunctionExpression ：<code>function() { return 1; }</code></p></li><li><p>成员访问：MemberExpression ：<code>obj.prop</code>, <code>arr[0]</code></p></li><li><p>模板字符串：TemplateLiteral：<code>hello ${name}</code></p></li></ul></li><li><p>函数表达式 FunctionExpression 节点内的重点内容</p><ul><li>函数名节点 FunctionExpression.id 为 标识符节点 Identifier，函数名 FunctionExpression.id.name，即 Identifier.name。匿名函数的 FunctionExpression.id 为 <code>null</code></li><li>函数参数数组 FunctionExpression.params，内部存放 标识符节点 Identifier。函数无传入参数时，FunctionExpression.params 为 []</li><li>函数体节点 FunctionExpression.body 为代码块节点 BlockStatement，FunctionExpression.body.body（BlockStatement.body）为函数内容数组，长度与函数体内容有关 <ul><li>返回值节点：ReturnStatement 节点，argument为返回内容，可以为字面量节点或表达式节点等</li></ul></li></ul><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// function c(a,b){return 1}</span>
<span class="token comment">// 移除部分信息的结构树</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FunctionDeclaration&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;generator&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;async&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">&quot;params&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BlockStatement&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;body&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ReturnStatement&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;argument&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NumericLiteral&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;rawValue&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;raw&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;directives&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="babel-api-简介" tabindex="-1"><a class="header-anchor" href="#babel-api-简介" aria-hidden="true">#</a> babel api 简介</h2><h3 id="常用代码结构" tabindex="-1"><a class="header-anchor" href="#常用代码结构" aria-hidden="true">#</a> 常用代码结构</h3><p>常用的编写流程如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 1. 导包 需要环境@babel/core</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/parser&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将源码解析成 ast</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/traverse&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>  <span class="token comment">// 遍历ast</span>
<span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/types&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 判断节点类型，构建新节点</span>
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/generator&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>  <span class="token comment">// 将ast解析成js</span>

<span class="token comment">// 2. 读取目标文件，解析为 ast</span>
<span class="token keyword">const</span> jscode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;./target.js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jscode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 处理目标js文件</span>
<span class="token comment">// ...</span>

<span class="token comment">// 4. 获取js，存储为新文件</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>code<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">&#39;./output.js&#39;</span><span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="parser" tabindex="-1"><a class="header-anchor" href="#parser" aria-hidden="true">#</a> parser</h3><blockquote><p>用于将 js 代码转换为AST</p></blockquote><p>官方文档 <a href="https://babeljs.io/docs/babel-parser" target="_blank" rel="noopener noreferrer">https://babeljs.io/docs/babel-parser<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jscode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// 常用配置项</span>
  <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>  <span class="token comment">// 当代码中存在 import export 时，需要配置此选项</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="generator" tabindex="-1"><a class="header-anchor" href="#generator" aria-hidden="true">#</a> generator</h3><blockquote><p>将AST转换为js对象，<code>&lt;js对象&gt;.code</code> 为转换后的代码</p></blockquote><p>可通过在处理代码时，将一部分节点还原为code并打印，便于调试。具体信息参考 <a href="####Path">Path</a> 中生成代码的部分</p><p>官方文档 <a href="https://babeljs.io/docs/babel-generator" target="_blank" rel="noopener noreferrer">https://babeljs.io/docs/babel-generator<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// 常用配置项</span>
  <span class="token literal-property property">retainLine</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 是否使用源代码行号，控制格式化内容</span>
  <span class="token literal-property property">comments</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 保留注释</span>
  <span class="token comment">// 压缩代码，行内压缩，不影响行号，配合 retainLine: false 可将代码压缩为单行</span>
  <span class="token literal-property property">compact</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// 中压缩，压缩代码，省略不必要的空格，保证行末分号</span>
  <span class="token comment">// minified: true  // 高压缩 省略不必要的行末分号和空格</span>
  <span class="token comment">// concise: true // 低压缩 保证空格为1，保留行末分号</span>
  
  <span class="token comment">// 高级配置项</span>
  <span class="token literal-property property">jsescOption</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  	<span class="token literal-property property">wrap</span><span class="token operator">:</span> boolean<span class="token punctuation">,</span>
  	<span class="token literal-property property">minimal</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token comment">// ascii码与unicode自动还原</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="traverse" tabindex="-1"><a class="header-anchor" href="#traverse" aria-hidden="true">#</a> traverse</h3><blockquote><p>遍历所给 ast 中的节点</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span>
<span class="token comment">// 参数 ast：目标 ast 节点</span>
<span class="token comment">// 参数 visitor：过滤方式</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>ast 目标节点。通常为整个加密代码的根节点</p></li><li><p>visitor</p><ul><li><p>声明 visitor</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 筛选条件。遍历所给节点下的所有函数表达式</span>
visitor<span class="token punctuation">.</span><span class="token function-variable function">FunctionExpress</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 注意：此处回调函数会接收到满足筛选条件的路径，不是节点</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;find function&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 等价代码</span>
<span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 属性为筛选条件，内容为回调函数</span>
  <span class="token function-variable function">FunctionExpress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;find function&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 等价代码。ES6语法，在对象属性为回调函数时的简写</span>
<span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">FunctionExpress</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;find function&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 节点访问时机</span>
<span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">FunctionExpress</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 进入时或退出时 enter / exit</span>
    <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 同上es6语法，enter属性为回调函数。</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;find function&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>当节点嵌套时的访问时机</p><ul><li><code>enter</code>：先处理该节点，再遍历该节点的子节点。处理可能会对子节点产生影响</li><li><code>exit</code>：先遍历该节点的子节点，在遍历到最内层后，依次向上层返回，此时依次判断并处理当前将返回上层的节点</li></ul></li><li><p>筛选条件为多类型，多类型节点使用同一函数处理。visitor 属性使用 <code>｜</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&#39;VariableDeclarator|FunctionDeclaration&#39;</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>同一类型节点使用多函数处理。代码<a href="https://lzc6244.github.io/2021/07/28/Babel-%E5%B0%8F%E6%8A%80%E5%B7%A7.html" target="_blank" rel="noopener noreferrer">来源<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">log_a</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is [a] function -- &#39;</span> <span class="token operator">+</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">log_b</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is [b] function -- &#39;</span> <span class="token operator">+</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">log_c</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;This is [c] function -- &#39;</span> <span class="token operator">+</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>init<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> visitor <span class="token operator">=</span>
<span class="token punctuation">{</span>
    <span class="token string-property property">&#39;VariableDeclarator&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#39;enter&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span>log_a<span class="token punctuation">,</span> log_c<span class="token punctuation">,</span> log_b<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>遍历部分节点</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jscode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 更新函数参数名</span>
<span class="token keyword">const</span> updateParamNameVisitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">Identifier</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 遍历函数中的所有标识符，形参和调用都需修改</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>paramName<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 通过this接收额外参数</span>
      path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;x&#39;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">FunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> paramName <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    path<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>updateParamNameVisitor<span class="token punctuation">,</span> <span class="token punctuation">{</span>paramName<span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 遍历部分节点</span>
    <span class="token comment">// 遍历路径.traverse(visitor, {额外参数})</span>
    <span class="token comment">// 此处是创建对象的简写，完整为 { paramName: paramName }</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span>  <span class="token comment">// 遍历全部节点</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="types" tabindex="-1"><a class="header-anchor" href="#types" aria-hidden="true">#</a> types</h3><blockquote><p>节点类型判断 与 构造新节点</p></blockquote><ul><li><p>判断节点类型。判断是否为标识符 <code>types.isIdentifier(path.node)</code>。等价代码<code>path.node.type === &#39;isIdentifier&#39;</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;isIdentifier&#39;</span> <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;n&#39;</span>
<span class="token comment">// 等价</span>
types<span class="token punctuation">.</span><span class="token function">isIdentifier</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;n&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 额外筛选条件通过对象传入</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>生成新节点</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/types&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/generator&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>


<span class="token keyword">let</span> right <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">binaryExpression</span><span class="token punctuation">(</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">numericLiteral</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">numericLiteral</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// right = 3 * 4</span>
<span class="token keyword">let</span> binExp <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">binaryExpression</span><span class="token punctuation">(</span><span class="token string">&#39;+&#39;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">numericLiteral</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span>  <span class="token comment">//  binExp = 2 + right</span>
<span class="token keyword">let</span> dclr <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">variableDeclarator</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> binExp<span class="token punctuation">)</span>  <span class="token comment">// 一个变量声明项 - 指明标识符名称与初始化内容 x = binExp</span>
<span class="token keyword">let</span> ast <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">variableDeclaration</span><span class="token punctuation">(</span><span class="token string">&#39;const&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>dclr<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 声明语句 const x = binExp</span>

<span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
<span class="token comment">// const x = 2 + 3 * 4;</span>

<span class="token comment">// 通过将目标代码放入 ast explorer，可得出大概结构</span>
<span class="token comment">// 编写节点时可查看源码确认所需参数</span>

<span class="token comment">// 例如 t.numericLiteral(3) 等 数字，字符串，布尔，对象，正则...等 静态值</span>
<span class="token comment">// 还可以使用 t.valueToNode 生成节点</span>
<span class="token keyword">let</span> node <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">valueToNode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token operator">/</span>\w<span class="token operator">/</span>s<span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span><span class="token string">&#39;1000&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 一个包含多个静态常量的静态数组</span>
<span class="token keyword">let</span> code1 <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span>code
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>code1<span class="token punctuation">)</span>

<span class="token comment">// 此处的坑</span>
<span class="token comment">// @babel/generator &gt;= 7.24.0</span>
<span class="token comment">// 当前Node 环境不支持 RegExp 的多 flag 输出格式（尤其是 /\w/s/g）</span>
<span class="token comment">// @babel/generator@7.22.x	输出 /\w/sg	✅ 正常</span>
<span class="token comment">// @babel/generator@7.24.x	输出 /\w/s/g	❌ 报错</span>
<span class="token comment">// @babel/generator@7.25.7+	输出 /\w/sg	✅ 修复</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="path" tabindex="-1"><a class="header-anchor" href="#path" aria-hidden="true">#</a> Path</h3><blockquote><p>在 visitor 遍历时，回调函数得到的是 Path（<code>NodePath</code>）对象</p></blockquote><p>在解析时，得到的是节点树。当遍历时，会将对应节点对象封装为Path（对当前节点对象进行包装，添加额外的信息属性），传入回调函数</p><ul><li><p>常用属性</p><ul><li><code>path.node</code> 当前节点（<code>Node</code>）对象（ast中解析出的json结构）。visitor 中只使用 <code>Node</code> 时，回调函数可编写解包，如： <code>Identifier( {node} ) { console.log(node) }</code></li><li><code>path.parent</code> <strong>父级节点（<code>Node</code>）对象</strong></li><li><code>path.parentPath</code> <strong>父级Path（NodePath）对象</strong></li><li><code>path.container</code> 同级节点列表</li><li><code>path.scope</code> 作用域<code>Scope</code></li></ul></li><li><p>常用方法</p><ul><li><p><code>path.stop()</code> 停止遍历在当前 path 及其下的子节点。常见使用方式：visitor中只处理某特征的节点，但不对其子节点处理，完成后调用 <code>stop</code> 停止子节点遍历 **注意，只想处理某一个节点，增加特征判断，使用return跳出。stop只停止子节点遍历，依然会操作后续节点 **</p></li><li><p><code>path.skip()</code> 遍历当前 path 下的子节点跳过。常见使用方式：visitor在遍历某一类节点时，不处理某些特征的节点，使用 <code>if</code> 判断并调用<code>skip</code>跳过</p></li><li><p><code>path.get</code> 获取子节点的<code>Node</code>和 <code>NodePath</code></p><ul><li><p>获取子节点 <code>Node</code>. 参考 ast解析结构，对不同种类的节点，通过 <code>Node</code> 访问其子节点对应的属性</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// BinaryExpression 节点</span>
path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>left  <span class="token comment">// 左操作项节点Node</span>
path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>right  <span class="token comment">// 右操作项节点Node</span>
path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>operator  <span class="token comment">// 操作符节点Node</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>获取子节点 <code>NodePath</code>。通过 <code>path.get()</code> 方法获取 <code>NodePath</code> 对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// BinaryExpression 节点</span>
path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;left&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 左操作项Path</span>
path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;right&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 右操作项节点Path</span>
path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;operator&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 操作符节点Path</span>

path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;left.name&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 多级访问</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>判断类型</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Node 对象通过 types 判断节点类型 - 判断的是 path.node.type</span>
types<span class="token punctuation">.</span><span class="token function">isIdentifier</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">)</span>
types<span class="token punctuation">.</span><span class="token function">isIdentifier</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;n&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 额外筛选条件，是不是变量名为n的变量</span>

<span class="token comment">// NodePath可直接判断 - 判断的是 path.type</span>
path<span class="token punctuation">.</span><span class="token function">isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
path<span class="token punctuation">.</span><span class="token function">isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;n&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 额外筛选条件，是不是变量名为n的变量</span>

<span class="token comment">// 一般情况下 path.type 与 path.node.type 一致</span>

<span class="token comment">// 类型断言，不符合抛出异常</span>
path<span class="token punctuation">.</span><span class="token function">assertIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>节点转代码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Node: 向 `generator` 传入 `Node` 用于生成代码（**不是Path**）</span>
<span class="token function">generator</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span>code

<span class="token comment">// Path: babel通过将 toString 重写，实现 path.toString 将 NodePath 转换成代码</span>
path<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
path <span class="token operator">+</span> <span class="token string">&#39;&#39;</span>  <span class="token comment">// 隐式转换。字符串拼接时，会隐式调用 toString</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>替换节点属性</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// BinaryExpression 节点，将二项式的左右属性（两个子节点）分别替换为 x 与 y</span>
path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>left <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>right <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>替换当前节点。通过 visitor 遍历需要替换的节点，进行替换。通常需要 <code>path.stop();</code> 防止死循环</p><ul><li><p><code>path.replaceWith</code> 将一个节点替换为一个新节点</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 将当前节点替换为数字字面量1</span>
path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">valueToNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>path.replaceWithMultiple</code> 将 path 所在节点替换为多个节点</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 将单条  return 替换为 两个表达式 与一个 return</span>
<span class="token function">ReturnStatement</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span><span class="token function">replaceWithMultiple</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    t<span class="token punctuation">.</span><span class="token function">expressionStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 表达式1</span>
		t<span class="token punctuation">.</span><span class="token function">expressionStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 表达式2</span>
    t<span class="token punctuation">.</span><span class="token function">returnStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>path.replaceInline</code> 将 path 所在节点替换为一个或多个新节点。源码中通过传入类型是否为数组自动调用 <code>replaceWith</code> 或 <code>replaceWithMultiple</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 替换成一个新节点 - 等效为 replaceWith</span>
path<span class="token punctuation">.</span><span class="token function">replaceInline</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">valueToNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 替换成多个新节点 - 等效为 replaceWithMultiple</span>
<span class="token function">ReturnStatement</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span><span class="token function">replaceInline</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    t<span class="token punctuation">.</span><span class="token function">expressionStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 表达式1</span>
		t<span class="token punctuation">.</span><span class="token function">expressionStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 表达式2</span>
    t<span class="token punctuation">.</span><span class="token function">returnStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>path.replaceWithSourceString</code> 将 path 所在节点替换为字符串源码对应的节点</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 返回值的函数混淆 - 将返回值替换为一个函数，真实返回值放入函数中返回</span>
<span class="token function">ReturnStatement</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> argumentPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;argument&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取返回值的 argument 节点Path。如果返回值为二项式，则此时是二项式的 Path</span>
  argumentPath<span class="token punctuation">.</span><span class="token function">replaceWithSourceString</span><span class="token punctuation">(</span>
    <span class="token string">&#39;function() {return &#39;</span> <span class="token operator">+</span> argumentPath <span class="token operator">+</span> <span class="token string">&#39;}()&#39;</span>  <span class="token comment">// 隐式转换。argumentPath 自动 toString 转换成源码字符串</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  path<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 由于生成了一个带返回值函数，不停止会遍历到新生成函数的返回值，再次进行替换，从而进入递归，出现死循环</span>
<span class="token punctuation">}</span>

<span class="token comment">// 注意替换内容与遍历内容是否一致，需调用 stop ，防止死循环</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><code>path.remove</code> 删除节点</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 删除多余的分号</span>
<span class="token function">EmptyStatement</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>插入节点 <code>path.insertBefore</code> 与 <code>path.insertAfter</code>，在指定 path 前 与 后插入兄弟节点</p></li></ul></li><li><p>父级Path</p><ul><li><p><code>path.parent</code> 父节点Node对象</p></li><li><p><code>path.parentPath</code> 父节点Path（NodePath）对象，因此<code>path.parentPath.node === path.parent</code></p></li><li><p>常用方法</p><ul><li><p><code>path.findParent </code> 对层层父节点 path 进行 find 操作。传入回调函数，回调形参为父节点path，函数体为 true 时返回该 path</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 获取包含 return 的对象表达式 path</span>
<span class="token function">ReturnStatement</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">{</span>
  <span class="token comment">// 形参 p 自动读取父节点 path</span>
  <span class="token comment">// 层层向上，直到 path 所在节点为对象表达式时返回</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">findParent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">isObjectExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>path.find</code> 对当前节点和层层父节点 path 进行 find 操作。与 <code>path.findParent </code> 类似，只多包含了当前节点</p></li><li><p><code>path.getFunctionParent</code> 获取父函数。find 条件为函数表达式</p></li><li><p><code>path.getStatementParent</code> 获取语句。find 条件为 Statement</p></li><li><p><code>path.parentPath.replaceWith(Node)</code> 与Path用法一致，替换父节点</p></li><li><p><code>path.parentPath.remove</code> 与Path一致，删除父节点</p></li></ul></li></ul></li><li><p>同级Path。介绍 Path 中的 <code>container</code>，<code>listKey</code>，<code>key</code> 属性。以下方代码中的 <code>return</code> 所在节点为例</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 例1：目标 return 语句</span>
<span class="token keyword">const</span> <span class="token function-variable function">x</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 解析结构如下解析</span>
<span class="token comment">// FunctionExpression.body = BlockStatement </span>
<span class="token comment">// BlockStatement.body = [ReturnStatement]  </span>

<span class="token comment">// 例2：目标 属性 b 的 ObjectProperty</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span>
<span class="token comment">// ObjectExpression.properties = [ObjectProperty, ObjectProperty, ObjectProperty]</span>
<span class="token comment">// ObjectProperty.key = Identifier</span>
<span class="token comment">// Identifier.name = &#39;a&#39;</span>

<span class="token comment">// 例3 例1代码的 BlockStatement</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>path.container</code>（容器） : 本节点所在容器的值（可用于获取同级节点）</p><ul><li>例1中，<code>ReturnStatement</code> 语句位于 <code>BlockStatement.body</code> 数组中， <code>container</code> 值为 <code>BlockStatement.body</code> 的值（解析的值为节点数组，不是Path），即 <code>[ReturnStatement]</code></li><li>例2中，<code>container</code> 值为 <code>ObjectExpression.properties</code> 的值，即 <code>[ObjectProperty, ObjectProperty, ObjectProperty]</code></li><li>例3中，<code>FunctionExpression.body</code> 不是数组，为 <code>BlockStatement</code>本身，一个函数只含有一个代码块。<code>container</code> 值为 <code>FunctionExpression</code> 节点，而不是 <code>FunctionExpression.body</code>（容器不指向自身）。</li></ul></li><li><p><code>path.key</code>：从 <code>container</code> 中获取该节点的 <code>container[]</code> 的 key 值</p><ul><li>例1中，由于获取该节点使用 <code>container[0]</code>，因此 <code>key</code> 值为 <code>0</code></li><li>例2中，由于获取该节点使用 <code>container[1]</code>，因此 <code>key</code> 值为 <code>1</code></li><li>例3中，由于 <code>container</code> 为 <code>FunctionExpression</code>，获取该节点使用<code>container[&#39;body&#39;]</code>，因此 <code>key</code> 值为 <code>body</code></li></ul></li><li><p><code>path.listKey</code>：容器对应的属性名</p><ul><li>例1中，<code>container</code> 为 <code>BlockStatement.body</code>，因此 <code>listKey</code> 为 <code>body</code></li><li>例2中，<code>container</code> 为 <code>ObjectExpression.properties</code>，因此 <code>listKey</code> 为 <code>properties</code></li><li>例3中，<code>container</code> 不是数组，因此为 <code>undefined</code></li></ul></li><li><p><code>path.inList</code> ：判断 <code>container</code> 是否为数组</p></li><li><p><code>container</code> 为数组时的常用方法（可用于操作同级节点）</p><ul><li><p><code>path.getSibling</code>：使用索引获取从 <code>container</code> 中同级节点 <code>path.getSibling(index)</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 获取当前节点的下一个节点</span>
path<span class="token punctuation">.</span><span class="token function">getSibling</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>key <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// path.key 为当前节点的索引，`+1` 指向下一个节点</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>path.parentPath.unshiftContainer</code> ：<code>container</code> 前部插入多个节点</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 将给定的节点数组放入当前节点所在容器的最前方（保持传入数组的顺序）</span>
<span class="token comment">// 指明容器位置: 父节点   的          body     节点数组</span>
path<span class="token punctuation">.</span>parentPath<span class="token punctuation">.</span><span class="token function">unshiftContainer</span><span class="token punctuation">(</span><span class="token string">&#39;body&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">valueToNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">valueToNode</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 返回值为新节点的Path数组（传入的是节点，返回的是包装为Path）</span>


<span class="token comment">// 通过returnStatement修改函数参数  function(a, b) {return 1}</span>
<span class="token comment">// AST结构：	FunctionExpression.params -&gt; [Idenetifier, Idenetifier]</span>
<span class="token comment">// 					FunctionExpression.body -&gt; BlockStatement</span>
<span class="token comment">// 					BlockStatement.body -&gt; [ReturnStatement]</span>
<span class="token comment">// 指定容器位置  FunctionExpression.params ，新增两个参数 x 和 y</span>
path<span class="token punctuation">.</span>parentPath<span class="token punctuation">.</span>parentPath<span class="token punctuation">.</span><span class="token function">unshiftContainer</span><span class="token punctuation">(</span><span class="token string">&#39;params&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">Idenetifier</span><span class="token punctuation">(</span><span class="token string">&#39;x&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">Idenetifier</span><span class="token punctuation">(</span><span class="token string">&#39;y&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>path.parentPath.pushContainer</code>：<code>container</code> 结尾追加节点</p></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 指明容器位置: 父节点   的      body    节点</span>
path<span class="token punctuation">.</span>parentPath<span class="token punctuation">.</span><span class="token function">pushContainer</span><span class="token punctuation">(</span><span class="token string">&#39;body&#39;</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">valueToNode</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 返回新节点的Path数组（数组固定只有一个成员，传入的是节点，返回的是包装为Path）</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><h3 id="scope" tabindex="-1"><a class="header-anchor" href="#scope" aria-hidden="true">#</a> scope</h3><p>使用 Path 对象的 <code>scope</code> 属性获取与处理指定Path的作用域相关内容</p><ul><li><p><code>path.scope.block</code> 获取标识符的作用域，得到作用域 Node 对象</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">var</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span>
  <span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>变量作用域。例子，获取变量 <code>c</code> 的作用域，assert：FuncionExpression</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 变量c的作用域为函数 func</span>
<span class="token function">Identifier</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span>block<span class="token punctuation">)</span>  <span class="token comment">// FuncionExpression</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>函数作用域。例子，获取函数 <code>func2</code> 的作用域，assert：FuncionExpression</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// func 的函数声明是函数表达式（匿名函数赋值）</span>
<span class="token comment">// func2 为函数声明</span>
<span class="token function">FunctionDclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span>block  <span class="token comment">// 与变量不一样，直接获取到的作用域是函数自己</span>
  path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>block<span class="token punctuation">.</span> <span class="token comment">// 父级作用域才是该函数真实的作用域</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>Binding 对象</p><ul><li><p><code>path.scope.getBinding</code> 获取当前节点上绑定的指定的标识符（当前节点可用的标识符，标识符作用域包含当前的 path）。返回值为 Binding 对象（对当前标识符节点对象进行包装，添加额外的信息属性）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ***** 案例1 *****</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">var</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span>
  <span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// func2 path</span>
<span class="token function">FunctionDclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">getBinding</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment">// func2 可以读取变量 a ，因此可获得全局变量 a 的 Binding</span>
<span class="token punctuation">}</span>

<span class="token comment">// ***** 案例2 *****</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">10</span>
  <span class="token keyword">return</span> a
<span class="token punctuation">}</span>
<span class="token comment">// f 函数 path</span>
<span class="token function">FunctionDeclaration</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">getBinding</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment">// a 变量重名，优先获取函数形参 a 的 Binding</span>
<span class="token punctuation">}</span>

<span class="token comment">// ***** Binding对象 *****</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">identifier</span><span class="token operator">:</span> 标识符 Node 对象<span class="token punctuation">,</span>
  <span class="token literal-property property">scope</span><span class="token operator">:</span> Scope <span class="token punctuation">{</span>
    <span class="token literal-property property">block</span><span class="token operator">:</span> 作用域 Node 对象<span class="token punctuation">,</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> 作用域 Node 的 NodePath 对象
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> 标识符 NodePath 对象<span class="token punctuation">,</span>  <span class="token comment">// 其中 含有 container:[[Node]]、listKey:params 等容器信息</span>
  <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&#39;param&#39;</span><span class="token punctuation">,</span>  <span class="token comment">// 该标识符类型</span>
  <span class="token literal-property property">constant</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 是否为常量</span>
  <span class="token literal-property property">constantViolations</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 变量被修改的 NodePath 数组（声明时的赋值不计算在内） </span>
                       <span class="token comment">// ！！重点，根据使用情况，对该变量操作，不影响其他节点</span>
                       <span class="token comment">// 仅依靠变量名称判断无法避免全局变量与局部变量重名时的误改</span>
  
  <span class="token comment">// 引用相关</span>
  <span class="token literal-property property">referencePaths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment">// 变量被引用的 NodePath 数组  </span>
    <span class="token comment">// ！！重点，根据使用情况，对该变量操作，不影响其他节点</span>
    <span class="token comment">// 仅依靠变量名称判断无法避免全局变量与局部变量重名时的误改</span>
  <span class="token literal-property property">referenced</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否引用（在 return 中引用）</span>
  <span class="token literal-property property">references</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 引用次数, 本例中，函数内的 `a=10` 只属于赋值，不属于引用</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>scope.hasBinding</code> 方法，判断是否有绑定。<code>false</code> 等效为 <code>getBinding</code> 方法返回 <code>undefined</code></p></li><li><p>通过 Binding 对象获取作用域。除了通过 <code>Identifier</code> 过滤变量名，得到 path 后获取 <code>scope</code> 外，还可以通过该标识符的 Binding 对象获取作用域（避免之前 案例2 中的变量 a 重名情况）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// ***** 案例 *****</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">var</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// FunctionExpression</span>
  <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span>
  <span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// FunctionDeclaration</span>
<span class="token punctuation">}</span>

<span class="token comment">// 案例中的变量 c</span>
<span class="token function">FunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 定位变量所在函数</span>
  <span class="token keyword">let</span> bindingC <span class="token operator">=</span> path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token string">&#39;c&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取 c 的 Binding 对象</span>
  bindingC<span class="token punctuation">.</span>scope<span class="token punctuation">.</span>block  <span class="token comment">// 通过 Binding 对象获取作用域</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>path.scope.getOwnBinding</code> 用于获取当前节点自己的绑定。如父节点中定义的变量等内容，不会通过此函数获取（如案例1中，函数内无法通过 <code>getOwnBinding</code> 获取全局变量）由于存在问题，一般不使用</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// getOwnBinding 案例</span>
<span class="token keyword">let</span> a
<span class="token keyword">const</span> <span class="token function-variable function">func1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 遍历 func1 内的标识符，查看哪些是 OwnBinding</span>
<span class="token function">FunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">Identifier</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> name <span class="token operator">=</span> p<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
      <span class="token comment">// 强转为 boolean，是否为 OwnBinding</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token operator">!</span>p<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">getOwnBinding</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出</span>
a <span class="token boolean">false</span>  <span class="token comment">// a 是全局变量</span>
b <span class="token boolean">true</span>  <span class="token comment">// b 是该函数内定义的</span>
func2 <span class="token boolean">false</span>  <span class="token comment">// **重点** 即使为函数内的定义，此时仍然不是 Own ， 需要注意避免</span>
c <span class="token boolean">true</span>  <span class="token comment">// **重点** 子函数内的也视为 Own，但理论上不应该为 Own ， 需要注意避免。需要额外判断作用域范围是否为当前标识符的作用域</span>
func2 <span class="token boolean">true</span>  <span class="token comment">// **重点** 函数内的定义的子函数，引用时才是 Own</span>


<span class="token comment">// 避免 getOwnBinding 的问题，增加作用域一致性判断</span>
<span class="token function">FunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">Identifier</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> name <span class="token operator">=</span> p<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
      <span class="token keyword">let</span> binding <span class="token operator">=</span> p<span class="token punctuation">.</span>scode<span class="token punctuation">.</span><span class="token function">getBinding</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// binding 与 作用域 所在代码是否一致</span>
      binding <span class="token operator">&amp;&amp;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token function">generator</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span>scope<span class="token punctuation">.</span>block<span class="token punctuation">)</span><span class="token punctuation">.</span>code <span class="token operator">==</span> path <span class="token operator">+</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>scope.hasOwnBinding</code> 方法，同理</p></li><li><p><code>scope.getAllBinding</code> 方法，获取当前节点的所有绑定。返回值类型为 Object，key 为 标识符名，value 为 Binding 对象。一样有 <code>getOwnBinding</code> 注意的点</p></li></ul></li><li><p>遍历作用域，通过 <code>scope.traverse</code> 遍历作用域中的节点</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 遍历作用域 案例</span>
<span class="token keyword">let</span> a
<span class="token keyword">const</span> <span class="token function-variable function">func1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 遍历 b 作用域中的节点</span>
<span class="token function">FunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 定位函数 func2</span>
  <span class="token keyword">const</span> binding <span class="token operator">=</span> path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 获取 b 的 Binding 对象 - func1的函数体 - b的作用范围，包括声明</span>
  binding<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span>scope<span class="token punctuation">.</span>block<span class="token punctuation">,</span> <span class="token punctuation">{</span>  <span class="token comment">// 传入作用域 Node 对象 - func1的函数体</span>
    <span class="token function">AssignmentExpression</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 赋值表达式</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>node<span class="token punctuation">.</span>left<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 定位 b 在哪里进行</span>
        p<span class="token punctuation">.</span>node<span class="token punctuation">.</span>right <span class="token operator">=</span> t<span class="token punctuation">.</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span><span class="token string">&#39;bbb&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 修改 b 的值</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>scope.rename</code> 方法可用于标识符重命名，并修改引用处</p><ul><li><p>重命名指定变量</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">func1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 通过变量的 Binding 修改</span>
<span class="token function">FunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> binding <span class="token operator">=</span> path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">getBinding</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  binding<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// binding.scope 会在作用域内生效</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用 path.scope.rename 需要保证遍历到全部节点，遍历条件需为 Identifier</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>scope.generateUidIdentifier</code> 方法生成标识符名。避免手动指定时，指定了一个已存在的标识符名</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 首次调用</span>
path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">generateUidIdentifier</span><span class="token punctuation">(</span><span class="token string">&#39;_id&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// 返回值：{type: &#39;Identifier&#39;, name: &#39;_id&#39;}</span>

<span class="token comment">// 第二次调用</span>
path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">generateUidIdentifier</span><span class="token punctuation">(</span><span class="token string">&#39;_id&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// 返回值：{type: &#39;Identifier&#39;, name: &#39;_id2&#39;}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>简单的标识符混淆</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 将所有标识符从 _0x28ba 起，按顺序重命名</span>
<span class="token function">Idetifier</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>name<span class="token punctuation">,</span> path<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">generateUidIdentifier</span><span class="token punctuation">(</span><span class="token string">&#39;_0x28ba&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
多次获取时的效果
{type: &#39;Identifier&#39;, name: &#39;_0x28ba&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba2&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba3&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba4&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba5&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba6&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba7&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba8&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba9&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba0&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba1&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba10&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba11&#39;}
{type: &#39;Identifier&#39;, name: &#39;_0x28ba12&#39;}
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><code>scope.hasReference</code> 方法。<code>hasReference(&#39;a&#39;)</code> 查看当前节点是否有标识符 a 的引用，返回值类型为 boolean。等效为标识符 a 的 Binding 对象中 referenced 的值</p></li><li><p><code>scope.getBindingIdentifier</code> 方法。<code>getBindingIdentifier(&#39;a&#39;)</code> 获取当前节点绑定的标识符 a 的 Node 对象（获取 <code>Identifier</code> 节点）</p></li><li><p><code>scope.getBindingIdentifier</code> 方法。同理</p></li></ul></li></ul></div><div id="comment" class="giscus-wrapper input-top" style="display:block;" data-v-77edf713><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div></div><!--]--><footer class="page_footer" data-v-2c01bf66><div class="footer_middle card_border" data-v-2c01bf66><!--[--><span data-v-2c01bf66>Released under the MIT License. <br data-v-2c01bf66></span><span data-v-2c01bf66>Copyright © 2023-present Leopold <br data-v-2c01bf66></span><!--]--></div></footer></div></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-101bb220.js" defer></script>
  </body>
</html>
