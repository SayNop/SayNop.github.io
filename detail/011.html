<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.68">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta property="og:url" content="https://saynop.github.io/detail/011.html"><meta property="og:title" content="常见汇编指令介绍"><meta property="og:description" content="汇编常用指令 简单说明几个不同种类常见汇编指令。指令的详细介绍、参数说明与例子 见《常用ARM指令集及汇编》 跳转指令 B (Branch) BL 带链接的无条件跳转。即跳转前会保存当前的地址，跳转部分指令执行完成会回到该地址。链接的保存可见本文 # 通过寄存器确定函数调用 中寄存器列表R14的说明 BX 带状态切换的无条件跳转。arm指令集下，CPSR中T标识位为0；thumb指令集下，T标识位为1。 观察每条指令间的地址差值 可判断当前为ARM指令（4字节） or thumb指令"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Assembly"><meta property="article:tag" content="Reverse"><meta property="article:tag" content="IDA"><meta property="article:published_time" content="2023-11-02T00:00:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"常见汇编指令介绍","image":[""],"datePublished":"2023-11-02T00:00:00.000Z","dateModified":null,"author":[]}</script><link rel="icon" href="/favicon.ico"><title>常见汇编指令介绍</title><meta name="description" content="汇编常用指令 简单说明几个不同种类常见汇编指令。指令的详细介绍、参数说明与例子 见《常用ARM指令集及汇编》 跳转指令 B (Branch) BL 带链接的无条件跳转。即跳转前会保存当前的地址，跳转部分指令执行完成会回到该地址。链接的保存可见本文 # 通过寄存器确定函数调用 中寄存器列表R14的说明 BX 带状态切换的无条件跳转。arm指令集下，CPSR中T标识位为0；thumb指令集下，T标识位为1。 观察每条指令间的地址差值 可判断当前为ARM指令（4字节） or thumb指令">
    <link rel="preload" href="/assets/style-3253bf1b.css" as="style"><link rel="stylesheet" href="/assets/style-3253bf1b.css">
    <link rel="modulepreload" href="/assets/app-942d488a.js"><link rel="modulepreload" href="/assets/011.html-5d39e696.js"><link rel="modulepreload" href="/assets/011.html-10672fd1.js">
    <link rel="prefetch" href="/assets/index.html-f33fda43.js" as="script"><link rel="prefetch" href="/assets/001.html-12451cc3.js" as="script"><link rel="prefetch" href="/assets/002.html-a6d5828c.js" as="script"><link rel="prefetch" href="/assets/003.html-3e8b49c2.js" as="script"><link rel="prefetch" href="/assets/004.html-689926d8.js" as="script"><link rel="prefetch" href="/assets/005.html-d6b96039.js" as="script"><link rel="prefetch" href="/assets/006.html-5b50a542.js" as="script"><link rel="prefetch" href="/assets/007.html-d3b6ddc8.js" as="script"><link rel="prefetch" href="/assets/008.html-042c4a7a.js" as="script"><link rel="prefetch" href="/assets/009.html-7d1574d7.js" as="script"><link rel="prefetch" href="/assets/010.html-f1724340.js" as="script"><link rel="prefetch" href="/assets/012.html-5e7aa08e.js" as="script"><link rel="prefetch" href="/assets/013.html-8dd46ba3.js" as="script"><link rel="prefetch" href="/assets/014.html-d0db391f.js" as="script"><link rel="prefetch" href="/assets/015.html-7a04f43c.js" as="script"><link rel="prefetch" href="/assets/016.html-79bc20a6.js" as="script"><link rel="prefetch" href="/assets/017.html-f2df444a.js" as="script"><link rel="prefetch" href="/assets/404.html-a0fec2a7.js" as="script"><link rel="prefetch" href="/assets/index.html-75381ff5.js" as="script"><link rel="prefetch" href="/assets/index.html-c95ce669.js" as="script"><link rel="prefetch" href="/assets/index.html-2c56dc8e.js" as="script"><link rel="prefetch" href="/assets/index.html-98874abd.js" as="script"><link rel="prefetch" href="/assets/index.html-b2308fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-10e703b4.js" as="script"><link rel="prefetch" href="/assets/index.html-5f3af54d.js" as="script"><link rel="prefetch" href="/assets/index.html-56349a98.js" as="script"><link rel="prefetch" href="/assets/index.html-a7c2713a.js" as="script"><link rel="prefetch" href="/assets/index.html-2e96c3d2.js" as="script"><link rel="prefetch" href="/assets/index.html-9f1eff22.js" as="script"><link rel="prefetch" href="/assets/index.html-16b34053.js" as="script"><link rel="prefetch" href="/assets/index.html-4e233464.js" as="script"><link rel="prefetch" href="/assets/index.html-d90f0ec9.js" as="script"><link rel="prefetch" href="/assets/index.html-3202320f.js" as="script"><link rel="prefetch" href="/assets/index.html-c3fe2c85.js" as="script"><link rel="prefetch" href="/assets/index.html-f3052411.js" as="script"><link rel="prefetch" href="/assets/index.html-5485bfc3.js" as="script"><link rel="prefetch" href="/assets/index.html-a7568890.js" as="script"><link rel="prefetch" href="/assets/index.html-9d25f5f2.js" as="script"><link rel="prefetch" href="/assets/index.html-ff33d682.js" as="script"><link rel="prefetch" href="/assets/index.html-3bce843e.js" as="script"><link rel="prefetch" href="/assets/index.html-09b9da96.js" as="script"><link rel="prefetch" href="/assets/index.html-750acad1.js" as="script"><link rel="prefetch" href="/assets/index.html-1c1e573d.js" as="script"><link rel="prefetch" href="/assets/index.html-8eb4570b.js" as="script"><link rel="prefetch" href="/assets/index.html-7dd1db94.js" as="script"><link rel="prefetch" href="/assets/index.html-32048506.js" as="script"><link rel="prefetch" href="/assets/index.html-a4e9e805.js" as="script"><link rel="prefetch" href="/assets/index.html-df3e534f.js" as="script"><link rel="prefetch" href="/assets/index.html-cb3cc9f5.js" as="script"><link rel="prefetch" href="/assets/index.html-0994fca8.js" as="script"><link rel="prefetch" href="/assets/index.html-a902e771.js" as="script"><link rel="prefetch" href="/assets/index.html-76fbbff6.js" as="script"><link rel="prefetch" href="/assets/index.html-7bc29919.js" as="script"><link rel="prefetch" href="/assets/index.html-2642a77f.js" as="script"><link rel="prefetch" href="/assets/index.html-8dfad283.js" as="script"><link rel="prefetch" href="/assets/index.html-0e75c0da.js" as="script"><link rel="prefetch" href="/assets/index.html-1d59d05d.js" as="script"><link rel="prefetch" href="/assets/index.html-8ff21503.js" as="script"><link rel="prefetch" href="/assets/001.html-252d2a29.js" as="script"><link rel="prefetch" href="/assets/002.html-515a1c28.js" as="script"><link rel="prefetch" href="/assets/003.html-fb4cd3a9.js" as="script"><link rel="prefetch" href="/assets/004.html-bccaaaec.js" as="script"><link rel="prefetch" href="/assets/005.html-1bb4c41b.js" as="script"><link rel="prefetch" href="/assets/006.html-e6f9622e.js" as="script"><link rel="prefetch" href="/assets/007.html-03abac91.js" as="script"><link rel="prefetch" href="/assets/008.html-57d098df.js" as="script"><link rel="prefetch" href="/assets/009.html-15a8ccea.js" as="script"><link rel="prefetch" href="/assets/010.html-c7c8aced.js" as="script"><link rel="prefetch" href="/assets/012.html-b318f593.js" as="script"><link rel="prefetch" href="/assets/013.html-5e16cd6a.js" as="script"><link rel="prefetch" href="/assets/014.html-196b8403.js" as="script"><link rel="prefetch" href="/assets/015.html-30091d6c.js" as="script"><link rel="prefetch" href="/assets/016.html-4fe39920.js" as="script"><link rel="prefetch" href="/assets/017.html-47460d1e.js" as="script"><link rel="prefetch" href="/assets/404.html-6e1173d4.js" as="script"><link rel="prefetch" href="/assets/index.html-6df8498c.js" as="script"><link rel="prefetch" href="/assets/index.html-123780e8.js" as="script"><link rel="prefetch" href="/assets/index.html-b8af0896.js" as="script"><link rel="prefetch" href="/assets/index.html-c498949e.js" as="script"><link rel="prefetch" href="/assets/index.html-b2c5f8c5.js" as="script"><link rel="prefetch" href="/assets/index.html-eae59417.js" as="script"><link rel="prefetch" href="/assets/index.html-6576ed46.js" as="script"><link rel="prefetch" href="/assets/index.html-5941a088.js" as="script"><link rel="prefetch" href="/assets/index.html-f494e42d.js" as="script"><link rel="prefetch" href="/assets/index.html-f6ac9019.js" as="script"><link rel="prefetch" href="/assets/index.html-5103cbce.js" as="script"><link rel="prefetch" href="/assets/index.html-19b82ae2.js" as="script"><link rel="prefetch" href="/assets/index.html-870a4c8f.js" as="script"><link rel="prefetch" href="/assets/index.html-53595de8.js" as="script"><link rel="prefetch" href="/assets/index.html-0480a43a.js" as="script"><link rel="prefetch" href="/assets/index.html-402fb83c.js" as="script"><link rel="prefetch" href="/assets/index.html-65daaed9.js" as="script"><link rel="prefetch" href="/assets/index.html-23336846.js" as="script"><link rel="prefetch" href="/assets/index.html-2bff2686.js" as="script"><link rel="prefetch" href="/assets/index.html-759b2963.js" as="script"><link rel="prefetch" href="/assets/index.html-24f9a61f.js" as="script"><link rel="prefetch" href="/assets/index.html-85e58d47.js" as="script"><link rel="prefetch" href="/assets/index.html-0f862fb0.js" as="script"><link rel="prefetch" href="/assets/index.html-6c29f570.js" as="script"><link rel="prefetch" href="/assets/index.html-66051298.js" as="script"><link rel="prefetch" href="/assets/index.html-91b475e1.js" as="script"><link rel="prefetch" href="/assets/index.html-7d262145.js" as="script"><link rel="prefetch" href="/assets/index.html-8a1f8413.js" as="script"><link rel="prefetch" href="/assets/index.html-b0bff3f3.js" as="script"><link rel="prefetch" href="/assets/index.html-31475e9c.js" as="script"><link rel="prefetch" href="/assets/index.html-3f6987ee.js" as="script"><link rel="prefetch" href="/assets/index.html-f268dac5.js" as="script"><link rel="prefetch" href="/assets/index.html-483a6c12.js" as="script"><link rel="prefetch" href="/assets/index.html-b26a5f88.js" as="script"><link rel="prefetch" href="/assets/index.html-65114dae.js" as="script"><link rel="prefetch" href="/assets/index.html-de571850.js" as="script"><link rel="prefetch" href="/assets/index.html-c04c7f7e.js" as="script"><link rel="prefetch" href="/assets/index.html-cb4ae314.js" as="script"><link rel="prefetch" href="/assets/index.html-7a0bdd3a.js" as="script"><link rel="prefetch" href="/assets/giscus-0b7adcf8.js" as="script"><link rel="prefetch" href="/assets/SearchResult-8d111893.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div data-v-77edf713><header class="header" style="opacity:0;" data-v-90176301><div class="header_container" data-v-90176301><div data-v-90176301><a class="header_title" href="/" data-v-90176301>Leopold&#39;s Blog</a></div><div class="appearance" data-v-90176301><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><!----></button><!--]--><button class="switch" data-v-90176301><span class="icon" style="display:block;" data-v-90176301><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" style="" data-v-90176301><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" style="display:none;" data-v-90176301><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></button><button class="switch mobile_list_btn" type="button" data-v-90176301><span class="btn_top" data-v-90176301></span><span class="btn_middle" data-v-90176301></span><span class="btn_bottom" data-v-90176301></span></button></div></div></header><div class="main"><div class="background" data-v-fee8de4c><svg class="pull_down" viewbox="0 0 1026 1024" xmlns="http://www.w3.org/2000/svg" data-v-fee8de4c data-v-3c8412b0><path d="M857.088 224.256q28.672-28.672 69.12-28.672t69.12 28.672q29.696 28.672 29.696 68.608t-29.696 68.608l-382.976 380.928q-12.288 14.336-30.72 19.968t-38.912 4.608-40.448-8.704-34.304-22.016l-376.832-374.784q-29.696-28.672-29.696-68.608t29.696-68.608q14.336-14.336 32.256-21.504t36.864-7.168 37.376 7.168 32.768 21.504l313.344 309.248z" data-v-3c8412b0></path></svg></div><div style="display:flex;"><div class="sider_keeper" data-v-e01a06ce><div class="folding" data-v-e01a06ce><!-- <div class="folding"> --><div class="sidebar_top card_border" style="min-height:1rem" data-v-e01a06ce><div class="tags_brand" data-v-e01a06ce>本文大纲</div><section class="article_sidebar" data-v-e01a06ce data-v-905b99e1><ul data-v-905b99e1><!--[--><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#汇编常用指令" data-v-905b99e1>汇编常用指令</a><ul class="level3" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#跳转指令" data-v-905b99e1>跳转指令</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#存储器与寄存器交互指令" data-v-905b99e1>存储器与寄存器交互指令</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#数据传送指令" data-v-905b99e1>数据传送指令</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#数据算术运算指令" data-v-905b99e1>数据算术运算指令</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#逻辑运算" data-v-905b99e1>逻辑运算</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#比较指令" data-v-905b99e1>比较指令</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#伪指令" data-v-905b99e1>伪指令</a><ul class="level4" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#伪指令ldr-与-存储寄存器交互指令ldr-的不同" data-v-905b99e1>伪指令LDR 与 存储寄存器交互指令LDR 的不同</a></li><li data-v-905b99e1><a class="sidebar-link" href="#通过伪指令加载指定数据" data-v-905b99e1>通过伪指令加载指定数据</a></li><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#堆栈寻址" data-v-905b99e1>堆栈寻址</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#指令转换" data-v-905b99e1>指令转换</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#三级流水线" data-v-905b99e1>三级流水线</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#cprs" data-v-905b99e1>CPRS</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#so内调用函数的入参分析" data-v-905b99e1>so内调用函数的入参分析</a><ul class="level3" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#通过寄存器确定函数调用" data-v-905b99e1>通过寄存器确定函数调用</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#判断即将跳转函数的参数个数" data-v-905b99e1>判断即将跳转函数的参数个数</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></li><!--]--></ul></section></div><div class="sidebar_bottom card_border" data-v-e01a06ce><div class="avatar" style="background-image:url(/assets/imgs/avatar.jpg);" data-v-e01a06ce></div><div class="author" data-v-e01a06ce>Leopold</div><div class="summary" data-v-e01a06ce><div data-v-e01a06ce><p data-v-e01a06ce>文章</p></div><div data-v-e01a06ce><p data-v-e01a06ce>分类</p></div><div data-v-e01a06ce><p data-v-e01a06ce>标签</p></div><div data-v-e01a06ce><p data-v-e01a06ce>17</p></div><div data-v-e01a06ce><p data-v-e01a06ce>9</p></div><div data-v-e01a06ce><p data-v-e01a06ce>28</p></div></div><div class="connection" data-v-e01a06ce><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M1023.560892 524.587752c0 114.331752-32.549236 217.148443-97.647709 308.450075-65.047295 91.301632-149.132822 154.455339-252.205404 189.512299-11.975662 2.303012-20.778286 0.716493-26.305515-4.759558a27.584966 27.584966 0 0 1-8.342021-20.471218V853.150798c0-44.166653-11.566238-76.511177-34.647536-96.982394a446.272549 446.272549 0 0 0 68.32269-12.282731c20.16415-5.476051 41.044792-14.329852 62.590748-26.612583a187.311643 187.311643 0 0 0 53.992837-45.446104c14.432209-18.014672 26.203159-41.914819 35.312851-71.751618 9.109692-29.8368 13.664538-64.074912 13.664538-102.765514 0-55.118754-17.554069-102.049021-52.61103-140.739623 16.376974-41.454216 14.636921-87.872703-5.373695-139.357815-12.436265-4.094244-30.399759-1.535341-53.941659 7.523172a355.17563 355.17563 0 0 0-61.311297 30.041513l-25.333132 16.376974a462.137743 462.137743 0 0 0-127.945112-17.707604 462.137743 462.137743 0 0 0-127.945111 17.758782 589.571074 589.571074 0 0 0-28.301459-18.424096c-11.77095-7.31846-30.34858-16.069906-55.681713-26.305515-25.281954-10.235609-44.422543-13.306292-57.31941-9.212048-19.498835 51.433935-21.085354 97.852421-4.606024 139.306637-35.108139 38.690602-52.713386 85.620869-52.713386 140.739623 0 38.690602 4.606024 72.826357 13.715716 102.458445 9.109692 29.58091 20.778286 53.481057 34.954605 71.700441a180.658498 180.658498 0 0 0 53.634591 45.753172c21.545957 12.282731 42.477777 21.18771 62.641926 26.612583 20.215328 5.527229 42.989557 9.621472 68.32269 12.333909-17.758781 16.376974-28.659705 39.867697-32.651593 70.369811a129.941055 129.941055 0 0 1-29.990334 10.235609 184.087426 184.087426 0 0 1-37.974109 3.428929c-14.688099 0-29.171485-4.913092-43.654872-14.688099-14.432209-9.826185-26.766117-24.053681-37.001726-42.682489a109.162769 109.162769 0 0 0-32.293346-35.517563c-13.101579-9.109692-24.104859-14.585743-33.009839-16.376974l-13.306292-2.047122c-9.314404 0-15.762838 1.023561-19.345301 3.070683-3.582463 2.047122-4.606024 4.606024-3.326572 7.83024a37.769397 37.769397 0 0 0 5.987831 9.570295 49.182101 49.182101 0 0 0 8.700267 8.188487l4.606024 3.377751c9.826185 4.606024 19.447657 13.255114 29.017952 25.998447 9.570294 12.743333 16.581686 24.360749 20.982998 34.80107l6.653146 15.71166c5.783119 17.298179 15.558126 31.320963 29.376197 42.017174 13.766894 10.747389 28.659705 17.554069 44.627255 20.471218 15.96755 2.968327 31.423319 4.606024 46.316131 4.810736 14.841633 0.204712 27.22672-0.562958 37.001726-2.405368l15.302235-2.712436c0 17.298179 0.102356 37.564685 0.358247 60.799517l0.307068 36.848192c0 8.188487-2.86597 15.046345-8.700268 20.471218-5.731941 5.527229-14.636921 7.113748-26.612583 4.810736-103.072582-35.056961-187.158109-98.261846-252.205404-189.512299C32.549236 741.736195 0 638.919504 0 524.587752c0-95.191163 22.876586-182.910331 68.629758-263.31104a516.028224 516.028224 0 0 1 186.288082-190.894106A491.309228 491.309228 0 0 1 511.780446 0.012795a491.309228 491.309228 0 0 1 256.913784 70.369811 516.028224 516.028224 0 0 1 186.236905 190.894106C1000.684306 341.626242 1023.560892 429.447767 1023.560892 524.587752z"></path></svg></div><div data-v-e01a06ce><span data-v-e01a06ce>github.com/SayNop</span></div><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z"></path></svg></div><div data-v-e01a06ce><span data-v-e01a06ce>gitee.com/WhenTimeGoesBy</span></div><!-- <div class="grid_icon"><mail_icon class="icon" /></div><div><span @click="open_link(themeData.connection_link.mail)">{{ themeData.connection_link.mail }}</span></div> --><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M874.666667 181.333333H149.333333c-40.533333 0-74.666667 34.133333-74.666666 74.666667v512c0 40.533333 34.133333 74.666667 74.666666 74.666667h725.333334c40.533333 0 74.666667-34.133333 74.666666-74.666667V256c0-40.533333-34.133333-74.666667-74.666666-74.666667z m-725.333334 64h725.333334c6.4 0 10.666667 4.266667 10.666666 10.666667v25.6L512 516.266667l-373.333333-234.666667V256c0-6.4 4.266667-10.666667 10.666666-10.666667z m725.333334 533.333334H149.333333c-6.4 0-10.666667-4.266667-10.666666-10.666667V356.266667l356.266666 224c4.266667 4.266667 10.666667 4.266667 17.066667 4.266666s12.8-2.133333 17.066667-4.266666l356.266666-224V768c0 6.4-4.266667 10.666667-10.666666 10.666667z"></path></svg></div><div data-v-e01a06ce><a href="mailto:fur999immer@gmail.com" data-v-e01a06ce>fur999immer@gmail.com</a></div></div></div></div></div><div class="content_container"><!--[--><div class="card_border article_container" data-v-77edf713><div class="frontmatter_info" data-v-77edf713><h1 data-v-77edf713>常见汇编指令介绍</h1><div data-v-77edf713>2023-11-02</div><div class="card_tag frontmatter_tags" data-v-77edf713><span class="icon" data-v-77edf713><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-77edf713><path d="M896 682.666667a42.666667 42.666667 0 0 0-42.666667-42.666667h-85.333333v-85.333333a85.333333 85.333333 0 0 0-85.333333-85.333334h-128V384h85.333333a42.666667 42.666667 0 0 0 42.666667-42.666667V170.666667a42.666667 42.666667 0 0 0-42.666667-42.666667H384a42.666667 42.666667 0 0 0-42.666667 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666667 42.666667h85.333333v85.333333H341.333333a85.333333 85.333333 0 0 0-85.333333 85.333334v85.333333H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666667 42.666667h256a42.666667 42.666667 0 0 0 42.666666-42.666667v-170.666666a42.666667 42.666667 0 0 0-42.666666-42.666667H341.333333v-85.333333h341.333334v85.333333h-85.333334a42.666667 42.666667 0 0 0-42.666666 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666666 42.666667h256a42.666667 42.666667 0 0 0 42.666667-42.666667z"></path></svg></span><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_category" data-v-77edf713 data-v-c2920afd>Assembly</span><!--]--><span class="icon" style="margin-right:5px;" data-v-77edf713><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-77edf713><path d="M985.6 473.6 985.6 473.6l-256 256-256 256 0 0C454.4 1011.2 422.4 1024 384 1024c-38.4 0-70.4-12.8-89.6-38.4l0 0-256-256 0 0C12.8 710.4 0 678.4 0 640c0-38.4 12.8-70.4 38.4-89.6l0 0 256-256 256-256 0 0C569.6 12.8 601.6 0 640 0l256 0c70.4 0 128 57.6 128 128l0 256C1024 422.4 1011.2 454.4 985.6 473.6zM768 128c-70.4 0-128 57.6-128 128 0 70.4 57.6 128 128 128 70.4 0 128-57.6 128-128C896 185.6 838.4 128 768 128z"></path></svg></span><!--[--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>Assembly</span><!--]--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>Reverse</span><!--]--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>IDA</span><!--]--><!--]--></div></div><div data-v-77edf713><h2 id="汇编常用指令" tabindex="-1"><a class="header-anchor" href="#汇编常用指令" aria-hidden="true">#</a> 汇编常用指令</h2><p>简单说明几个不同种类常见汇编指令。指令的详细介绍、参数说明与例子 见《常用ARM指令集及汇编》</p><h3 id="跳转指令" tabindex="-1"><a class="header-anchor" href="#跳转指令" aria-hidden="true">#</a> 跳转指令</h3><p>B (Branch)</p><ul><li><code>BL</code> 带链接的无条件跳转。即跳转前会保存当前的地址，跳转部分指令执行完成会回到该地址。链接的保存可见本文 <a href="#%E9%80%9A%E8%BF%87%E5%AF%84%E5%AD%98%E5%99%A8%E7%A1%AE%E5%AE%9A%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"># 通过寄存器确定函数调用</a> 中寄存器列表R14的说明</li><li><code>BX</code> 带状态切换的无条件跳转。arm指令集下，CPSR中T标识位为0；thumb指令集下，T标识位为1。 <strong>观察每条指令间的地址差值</strong> 可判断当前为ARM指令（4字节） or thumb指令</li></ul><h3 id="存储器与寄存器交互指令" tabindex="-1"><a class="header-anchor" href="#存储器与寄存器交互指令" aria-hidden="true">#</a> 存储器与寄存器交互指令</h3><ul><li><p>LDR与STR</p><ul><li><code>LDR &lt;待加载寄存器&gt; &lt;数据地址&gt;</code>(Load from memory into a regisiter) 从存储器中加载数据到寄存器，赋值方向 <code>&lt;-</code>。eg：将<code>R9+0x4</code>指向的存储单元内的数据加载到R8中。其中<code>[]</code>意为取值，类似指针中的<code>*</code>。与立即数的操作 <strong>不会修改参数寄存器内的值</strong> 。该方法为基址寻址，常用于查表等操作。详见《常用ARM指令集及汇编》基址寻址章节</li></ul><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>; 将寄存器中的数据作为地址，找到指定位置的数据存储到R3寄存器中
LDR R3 [R0]
; IDA动态调试查看R0中数据为415E6F98，点击数值后方的箭头跳转到目标位置，发现如下数据
; 415E6F98 DCB 0xE8
; 415E6F99 DCB 0x63
; 415E6F9A DCB 0x5B
; 415E6F9B DCB 0x41
; ARM指令4字节数据写入R3，R3中数据为 0x415B63E8 (小端存储，低地址为低位) 

; 先与立即数进行计算后取值，不会修改R9内的值
LDR R8,[R9,#4]

; 将 sp寄存器的值 + (#0x10+var_4) 的值所指向地址内的数据值 赋值给LR寄存器 不会修改SP指针内的值
LDR LR, [SP,#0x10+var_4]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>STR &lt;数据寄存器&gt; &lt;待存储地址&gt;</code> 将寄存器中数据存储到存储器，赋值方向<code>-&gt;</code>。 eg：将R8寄存器中的数据存储到R9+0x4指向的存储单元</li></ul><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>STR R8,[R9,#4]

; 将 R0寄存器的值 存储到 SP寄存器的值 + (#0x10+var_4) 的值作为地址所指向的单元格中
STR R0, [SP,#0x10+var_4]

; 将LR内的数据压栈（栈顶上移一格, 并将LR内的值写入上移的空间）
; `!` 在执行完出入栈后会相应修改SP指向
STR LR, [SP, #-4]!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>LDM与STM</p><ul><li><code>LDM</code> 将存储器数据依次加载到寄存器列表，赋值方向<code>-&gt;</code>。eg：将R0指向的存储单元数据依次加载到R1，R2，R3。此时第一个参数相当于指针取值，<code>R1=*R0</code>，<code>R2=*(R0+#1)</code>，<code>R3=*(R0+#2)</code></li></ul><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>LDM R0, {R1-R3}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><code>STM</code> 将寄存器列表数据存储到指定存储器，赋值方向<code>&lt;-</code>。关于读取与存储的顺序，详见本文 <a href="#%E5%A0%86%E6%A0%88%E5%AF%BB%E5%9D%80"># 堆栈寻址</a></li></ul></li><li><p>PUSH与POP</p><ul><li><code>PUSH</code> 入栈</li><li><code>POP</code> 出栈</li></ul></li><li><p>SWP：将寄存器与存储器之间的数据进行交换。三个参数Rd，Rm，[Rn]，将R0指向空间的内容放入Rd，后将Rm的内容放入Rn指向的空间。eg：将寄存器与存储器之间的数据进行交换</p><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>SWP R1,R1 [R0]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h3 id="数据传送指令" tabindex="-1"><a class="header-anchor" href="#数据传送指令" aria-hidden="true">#</a> 数据传送指令</h3><p><code>MOV</code> 将立即数货寄存器数据传送到目标寄存器，赋值方向<code>&lt;-</code>。eg1：R0赋值为8。eg2：R2先左移3位后放入R0，即R0 = R2 * 2^3 = R2 * 8（关于 <strong>移位</strong> 详见《常用ARM指令集及汇编》章节：寄存器偏移寻址）</p><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>MOV R0, #8
MOV R0, R2, LSL #3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据算术运算指令" tabindex="-1"><a class="header-anchor" href="#数据算术运算指令" aria-hidden="true">#</a> 数据算术运算指令</h3><p>三个参数Rd，Rm，Rn。其中Rd存放结果，Rm为操作数1，Rn为操作数2</p><ul><li>ADD</li><li>SUB</li><li>MUL</li><li>DIV</li></ul><h3 id="逻辑运算" tabindex="-1"><a class="header-anchor" href="#逻辑运算" aria-hidden="true">#</a> 逻辑运算</h3><p>三个参数Rd，Rm，Rn。其中Rd存放结果，Rm为操作数1，Rn为操作数2</p><ul><li>AND</li><li>OR</li><li>EOR：异或。不同为1（真）</li></ul><h3 id="比较指令" tabindex="-1"><a class="header-anchor" href="#比较指令" aria-hidden="true">#</a> 比较指令</h3><p>CMP（compare）在CPRS寄存器中标志位存储比较结果，Z=0表示不相等</p><h3 id="伪指令" tabindex="-1"><a class="header-anchor" href="#伪指令" aria-hidden="true">#</a> 伪指令</h3><p>为了编程方便，编译器定义了伪指令。伪指令在编译时会被替换成合适的指令。arm中常用伪指令有<code>ADR</code>，<code>LDR</code>等。此处着重说明<code>LDR</code>指令。</p><h4 id="伪指令ldr-与-存储寄存器交互指令ldr-的不同" tabindex="-1"><a class="header-anchor" href="#伪指令ldr-与-存储寄存器交互指令ldr-的不同" aria-hidden="true">#</a> 伪指令LDR 与 存储寄存器交互指令LDR 的不同</h4><p>由于伪指令会被替换，存储器与寄存器交互指令<code>LDR</code>与伪指令<code>LDR</code>本质上是 <strong>不同</strong> 的指令。以下是详细说明：</p><ul><li>ARM指令集中的LDR是寻址指令。参数2常为指定地址的上的值（LDR Rd,[地址] -- 多伴随取值符<code>[]</code>）。例如：读取 <em>R0-0x12</em> 地址上的值，存储到R1</li></ul><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>LDR R1, [R0, #-0x12]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>伪指令LDR用户指定寄存器加载内容。参数2常为表达式（LDR reg,=立即数/表达式 -- 等号开头）。例如：</li></ul><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>LDR R0, =(#0x1)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="通过伪指令加载指定数据" tabindex="-1"><a class="header-anchor" href="#通过伪指令加载指定数据" aria-hidden="true">#</a> 通过伪指令加载指定数据</h4><p>使用IDA工具并设置机器码的显示( Option -&gt; General -&gt; Disassembly -&gt; Number of opcode bytes: 5)。以下两例均来自参考文章<a href="https://bbs.kanxue.com/thread-268869.htm" target="_blank" rel="noopener noreferrer">https://bbs.kanxue.com/thread-268869.htm<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>例1</strong> ：以C++程序helloworld代码main函数为例说明如何通过 <strong>伪指令<code>LDR</code>引用字符串常量</strong>。</p><div class="macos language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>; 目标字符串存放位置
.rodata:000008E4 68 65 6C 6C 6F+aHelloWorld     DCB &quot;hello world&quot;,0     ; DATA XREF: main+A↑o
.rodata:000008E4 20 77 6F 72 6C+                                        ; .text:off_788↑o

; main函数中的代码片段 - 获取目标字符串起始地址
.text:00000760 09 4B                          LDR             R3, =(aHelloWorld - 0x766)
.text:00000762 7B 44                          ADD             R3, PC  ; &quot;hello world&quot;

; 函数结束后的内存偏移表
.text:00000788 7E 01 00 00    off_788         DCD aHelloWorld - 0x766 ; DATA XREF: main+8↑r
.text:00000788                                                        ; &quot;hello world&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>说明：</p><ul><li><p>main函数中LDR的第二个参数为表达式（带等号），此LDR为伪指令 `</p></li><li><p><code>LDR</code>与<code>ADD</code>两条指令组成引用字符串常量的过程(<code>LDR</code>读取偏移，<code>ADD</code>计算目标地址)。如果同时引用多个，<code>LDR</code>与<code>ADD</code>可能不会连续出现，通常为多条<code>LDR</code>后接多条对应的<code>ADD</code></p></li><li><p>伪指令的表达式是 <strong>内存偏移表</strong> 中的内容。 将对应内存偏移表中的机器码 <em>17E</em> 存储到R3</p></li><li><p>ADD执行完成后 <em>R3 = R3 + PC = 17E + 762 + 4= 8E4</em> ，即R3存放<code>.rodata</code>节区中字符串的起始地址</p></li><li><p>被减数为内存偏移表对应项地址，此时 adr加载对应项地址 + 对应项偏移量 = 目标地址</p></li></ul></li></ul><p><strong>内存偏移表</strong>：</p><ul><li><p>由于地址长度为4字节。在thumb指令集中指令长度为2字节，不可直接将<code>.bss</code>段或<code>.rodata</code>段中目标的偏移量放入指令中（目标偏移量过大会超过两字节大小）。arm32中引入内存偏移表存放偏移量，指令中通过内存偏移表与当前代码的偏移量读取对应项，并将存放的目标偏移量直接存入寄存器而无需写在指令中</p></li><li><p>内存偏移表 通常在一个函数的结尾处（<code>BLX LR</code>函数返回后。与pc偏移量可控，不会超过2字节）。其中 <em>被减数</em> 即为 <em>引用地址(便于自己理解的定义)</em> ，如上例中的位于 <em>762</em> 的<code>ADD R3 PC</code>，此时R3指向目标地址，PC为引用地址，所以被减数为当前地址值+PC固有两条指令偏移，即PC实际值为<code>762+4=766</code></p></li><li><p>LDR伪指令加载目标地址的方式：读取内存偏移表中的引用地址与目标地址偏移量 + 当前代码位置 = 目标地址</p></li><li><p>由于三级流水线的存在导致PC并不是调用行的地址，内存偏移表 <strong>涉及PC引用的项</strong> 会存在2条指令地址的偏移即 <strong>汇编代码内计算得到的地址需要额外再+2条指令的地址才是目标地址</strong> 。因此例1说明中的第三点需要+4。详见本文 <a href="#%E4%B8%89%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"># 三级流水线</a> 中PC的说明</p></li></ul><p><strong>例2</strong> ：以C++程序helloworld代码_start函数为例说明如何通过 <strong>伪指令<code>LDR</code>和<code>ADR</code>载入全局偏移表（.got）</strong></p><div class="macos language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>; _start函数中的代码片段 - 获取全局偏移表起始地址
.text:00000658 DF F8 24 A0                    LDR.W           R10, =($_GLOBAL_OFFSET_TABLE_ - 0x680)
.text:0000065C 08 A3                          ADR             R3, off_680
.text:0000065E 9A 44                          ADD             R10, R3 ; $_GLOBAL_OFFSET_TABLE_

; 函数结束后的内存偏移表
.text:00000680 80 09 01 00    off_680         DCD $_GLOBAL_OFFSET_TABLE_ - 0x680
.text:00000680                                                        ; DATA XREF: _start+10↑r
.text:00000680                                                        ; _start+14↑o

; 全局偏移表起始位置 - 目标地址
.got:00011000 00 0F 01 00    $_GLOBAL_OFFSET_TABLE_ DCD stru_10F00   ; DATA XREF: .plt:000005D8↑o
.got:00011000                                                        ; .plt:off_5E4↑o ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>说明： <ul><li>R10 加载内存偏移表中的机器码（偏移量） <em>10980</em></li><li>R3 加载内存偏移表对应项 <em>off_680</em> 的地址 <em>680</em> - <strong>此处不涉及PC寄存器，因此最后不需要额外+4，详见参数文章链接</strong><a href="https://bbs.kanxue.com/thread-268869.htm" target="_blank" rel="noopener noreferrer">https://bbs.kanxue.com/thread-268869.htm<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>ADD执行完成后 <em>R10 = 10980 + 680 = 11000</em> ，即R10存放全局偏移表的起始地址</li></ul></li></ul><p><strong>补充</strong>：如何修改需要读取的字符串，请查看后续文章中的内容</p><p><strong>例3</strong>：以C++程序helloworld代码deregister_tm_clones函数为例说明如何通过 <strong>伪指令<code>LDR</code>载入全局偏移表（.got）内的数据</strong></p><div class="macos language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>.text:000006B4 deregister_tm_clones                    ; CODE XREF: __do_global_dtors_aux:loc_732↓p
.text:000006B4                 LDR             R0, =(__bss_start - 0x6BE)
.text:000006B6                 LDR             R3, =(__bss_start - 0x6C0)
.text:000006B8                 LDR             R2, =($_GLOBAL_OFFSET_TABLE_ - 0x6C2)
.text:000006BA                 ADD             R0, PC  ; __bss_start
.text:000006BC                 ADD             R3, PC  ; __bss_start
;                              通过ldr与add，此时R2为全局偏移表基地址
.text:000006BE                 ADD             R2, PC  ; $_GLOBAL_OFFSET_TABLE_
.text:000006C0                 CMP             R3, R0
.text:000006C2                 BEQ             locret_6CC
;                              r3存放目标与内存偏移表基地址偏移量
.text:000006C4                 LDR             R3, =(_ITM_deregisterTMCloneTable_ptr - 0x11000)
;                              通过基地址+偏移量 使 r3指向目标
.text:000006C6                 LDR             R3, [R2,R3] ; _ITM_deregisterTMCloneTable
.text:000006C8                 CBZ             R3, locret_6CC
.text:000006CA                 BX              R3      ; _ITM_deregisterTMCloneTable
.text:000006CC ; ---------------------------------------------------------------------------
.text:000006CC
.text:000006CC locret_6CC                              ; CODE XREF: deregister_tm_clones+E↑j
.text:000006CC                                         ; deregister_tm_clones+14↑j
.text:000006CC                 BX              LR
.text:000006CC ; End of function deregister_tm_clones
.text:000006CC
.text:000006CC ; ---------------------------------------------------------------------------
.text:000006CE                 ALIGN 0x10
.text:000006D0 off_6D0         DCD __bss_start - 0x6BE ; DATA XREF: deregister_tm_clones↑r
.text:000006D4 off_6D4         DCD __bss_start - 0x6C0 ; DATA XREF: deregister_tm_clones+2↑r
.text:000006D8 off_6D8         DCD $_GLOBAL_OFFSET_TABLE_ - 0x6C2
.text:000006D8                                         ; DATA XREF: deregister_tm_clones+4↑r
;                              目标在全局偏移表内的偏移量 - 全局偏移表基地址为0x11000
.text:000006DC off_6DC         DCD _ITM_deregisterTMCloneTable_ptr - 0x11000
.text:000006DC                                         ; DATA XREF: deregister_tm_clones+10↑r
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="堆栈寻址" tabindex="-1"><a class="header-anchor" href="#堆栈寻址" aria-hidden="true">#</a> 堆栈寻址</h3><p>堆栈的工作方式按照不同方式分类有多种</p><ul><li><p>根据栈顶指针指向分为</p><ul><li><p>满栈（Full Stask）：指向栈顶元素</p></li><li><p>空栈（Empty Stack）：指向栈顶的下一个空位（栈顶元素上方，新入栈数据将存放的空间）</p></li></ul></li><li><p>根据堆栈数据存放的地址方向分为</p><ul><li><p>递增堆栈（Ascending Stack）：由低地址向高地址生成</p></li><li><p>递减堆栈（Decending Stack）：由高地址向低地址生成</p></li></ul></li></ul><p>处理器在设计时便定好了采用哪种堆栈方式，用户不可更改。例如：ARM堆栈的工作方式为 <strong>满递减堆栈(FD - full decending)</strong> ，即按照视觉顺序，栈顶位于低地址，且栈顶指针 <code>SP</code> 指向栈顶元素。</p><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>; 数据入栈，最后入栈的数据为r0，即执行完成后栈顶为r0（降序入栈，第一个最后入）！
STMFD SP! {r0,r1,r3-r5}
; 数据出栈，第一个出栈数据赋值给r0（降序出栈，第一个出栈存入第一个寄存器）
LDMFD SP! {r0,r1,r3-r5}

; `!` 在执行完出入栈后会相应修改SP指向
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>函数在调用时会产生一系列变量，此时需要在栈中创建存储空间进行存储。因此<code>STMFD</code>与<code>LDMFD</code>常常成对出现</p><p><code>STMFD</code>将寄存器列表内的值入栈，保证第一项在栈顶。<code>LDMFD</code>将栈内的数据放回寄存器列表，按寄存器列表顺序取值。存放数据与读取数据顺序可理解为井中放绳，即排在最后的先进后出。<code>SP!</code> 会自动进行sp指针值变化的计算，不需手动对SP值进行加或减</p><h3 id="指令转换" tabindex="-1"><a class="header-anchor" href="#指令转换" aria-hidden="true">#</a> 指令转换</h3><p>通过将操作数转换格式以实现伪指令的转化，如通过快捷键<code>d</code>将偏移量转化成基本数据，或将字符串转换成字符数据</p><p>以下为IDA中一段代码实例。注意 STM 存放数据顺序与 ADR/LDR伪代码</p><div class="macos language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>;             内存偏移表        字符串地址001468EA
LOAD:00145C4C off_145C4C      DCD aCk1234567+0xA - 0x145C4C

;                             将lr, r2, r1, r0 依次压入栈 保证 r0 为栈顶
LOAD:00145C5C                 STMFD           SP!, {R0-R2,LR}
;                             r1 为内存偏移表对应项的地址，adr内部已做偏移处理
LOAD:00145C60                 ADR             R1, off_145C4C
;                             LDR伪指令 通过内存偏移表加载字符串
LOAD:00145C64                 LDR             R0, =(aCk1234567+0xA - 0x145C4C)
;                             内存偏移表做加法，r0指向目标
LOAD:00145C68                 ADD             R0, R0, R1 ; &quot;&quot;
LOAD:00145C6C                 LDR             R2, =off_145C4C
LOAD:00145C70                 SUB             R1, R1, R2
LOAD:00145C74                 STMFD           SP!, {R1}
LOAD:00145C78                 LDR             R2, =dword_4B4BC
LOAD:00145C7C                 ADD             R1, R1, R2
LOAD:00145C80                 STMFD           SP!, {R1}
LOAD:00145C84                 BL              sub_146568
LOAD:00145C88                 MOV             R2, R0
LOAD:00145C8C                 ADR             R1, off_145C4C
LOAD:00145C90                 LDR             R0, =(aCk1234567+0xA - 0x145C4C)
LOAD:00145C94                 ADD             R0, R0, R1 ; &quot;&quot;
LOAD:00145C98                 LDMFD           SP!, {R1}
LOAD:00145C9C                 BL              sub_146248
LOAD:00145CA0                 LDMFD           SP!, {R1}

; ... 此处省略部分指令 ...

; 字符串定义部分                 
LOAD:001468EA                 aCk1234567      DCB &quot;ck1234567_&quot;,0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>说明 <ul><li><p>内存偏移表中 对应项的被减数为对应项地址，该地址被r1加载（偏移已被adr内部处理）</p></li><li><p>在上一条的条件下，执行ldr加载内存偏移表并add，则会指向目标地址（已在例2中说明）</p></li></ul></li></ul><p>通过将偏移量转换成基本数据，得到如下等效代码（省略部分）</p><div class="macos language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>;             内存偏移表转换成具体数值 0x1468EA + 0xA - 0x145C4C = 0xCA8
LOAD:00145C4C dword_145C4C    DCD 0xCA8

LOAD:00145C5C                 STMFD           SP!, {R0-R2,LR}
LOAD:00145C60                 ADR             R1, dword_145C4C
;                             直接赋值偏移表内的偏移量做加法得到字符串地址
LOAD:00145C64                 LDR             R0, =0xCA8
LOAD:00145C68                 ADD             R0, R0, R1 ; &quot;&quot;
LOAD:00145C6C                 LDR             R2, =dword_145C4C
LOAD:00145C70                 SUB             R1, R1, R2
LOAD:00145C74                 STMFD           SP!, {R1}
LOAD:00145C78                 LDR             R2, =dword_4B4BC
LOAD:00145C7C                 ADD             R1, R1, R2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三级流水线" tabindex="-1"><a class="header-anchor" href="#三级流水线" aria-hidden="true">#</a> 三级流水线</h2><p>ARM7TDM使用三级流水线执行指令。</p><ol><li>内存中取回指令</li><li>开始解码</li><li>实际执行指令</li></ol><p>程序计数器（PC）总是指向<strong>正在读取的指令而非正在执行的指令，超出当前执行指令的两条指令</strong> 。即第x条指令若读取pc寄存器内的值，实际上是读取第(x+2)条指令的地址</p><p>在 <em>IDA</em> 动态调试时，若F7单步执行到某一条指令时（与其他ide类似，卡在将执行的指令上），其实CPU已经开始处理目标指令后面的两条指令了（下一条指令已开始解码，下下条指令已开始读取）。指令窗口中的PC（假PC）指向的是将执行的指令，而寄存器窗口的PC（真PC）值已为下下条指令的地址（参考文章<a href="https://www.cnblogs.com/dliv3/p/5285771.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/dliv3/p/5285771.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）</p><p>故在动态调试过程中需要修改指令时，需在 <strong>执行前两条之前进行修改</strong> （执行到的指令与要修改的指令至少间隔2条指令）</p><h2 id="cprs" tabindex="-1"><a class="header-anchor" href="#cprs" aria-hidden="true">#</a> CPRS</h2><p>全称 Current Program Status Register, 各个bit位表明了CPU的某些状态信息<br></p><p>下方为部分bit的介绍</p><table><thead><tr><th>标识位</th><th>说明</th></tr></thead><tbody><tr><td>N</td><td>Set when the result of the operation was Negative.(负数置1，非负数置0)</td></tr><tr><td>Z</td><td>Set when the result of the operation was Zero.(为零置1，非零置0)</td></tr><tr><td>C</td><td>Set when the operation result in a Carry.(发生进位，或借位时，置1)</td></tr><tr><td>V</td><td>Set when the operation caused oVerflow.(操作造成溢出时，置1。如计算补码)</td></tr></tbody></table><h2 id="so内调用函数的入参分析" tabindex="-1"><a class="header-anchor" href="#so内调用函数的入参分析" aria-hidden="true">#</a> so内调用函数的入参分析</h2><p>BL与BLX指令常常伴随函数调用出现。函数参数的传递是通过寄存器与堆栈实现的</p><h3 id="通过寄存器确定函数调用" tabindex="-1"><a class="header-anchor" href="#通过寄存器确定函数调用" aria-hidden="true">#</a> 通过寄存器确定函数调用</h3><p>在寄存器列表中：</p><ul><li><em>R0 ~ R3</em> 共4个寄存器用于函数参数及返回值的传递（<strong>函数相关</strong>）</li><li><em>R4 ~ R6 / R8 / R10 / R11</em> 普通的通用寄存器</li><li><em>R7</em> 数据栈帧的指针，链接寄存器LR在栈上的地址</li><li><em>R9</em> 系统保留寄存器</li><li><em>R12</em> IP的值</li><li><em>R13</em> 栈顶指针SP - 当指针指向的地址为栈顶元素所在地址，即为满栈。若指向栈顶元素上方的地址（栈顶元素地址-4，可理解为预留位置），即为空栈</li><li><em>R14</em> 链接寄存器LR。所处代码作为函数的返回地址</li><li><em>R15</em> 程序计数器PC的值</li></ul><p><strong>说明：</strong></p><ul><li>R14中存放的不是调用函数的地址，而是当前代码段执行完成后将跳转的地址</li><li>若函数有返回值，则放在R0中。查看函数调用<code>B</code>后的下一行有没有读取或<code>MOV</code>寄存器R0中的值来判断是否有返回值</li></ul><h3 id="判断即将跳转函数的参数个数" tabindex="-1"><a class="header-anchor" href="#判断即将跳转函数的参数个数" aria-hidden="true">#</a> 判断即将跳转函数的参数个数</h3><ul><li><code>BLX</code>的目标值是否为 <em>R0~R3</em> 寄存器（根据参数寄存器为 <em>R0~R3</em> 进行判断） <ul><li><p>是：参数个数小于4个时，<code>BLX</code>的跳转地址为目标函数地址，之前的寄存器皆为函数参数。例如：<code>BLX R3</code> 说明函数有3个参数，分别存储在 R0、R1、R2，而R3存放目标函数地址。</p></li><li><p>否：参数个数量大。前4个参数在 <em>R0~R3</em> 寄存器中。剩下的在跳转指令前通过<code>STR</code>或<code>STM</code>放入堆栈（并不一定入栈的数据都是参数，需要分析。若前面没有<code>STR</code>或<code>STM</code>压栈操作，则为4个）</p></li><li><p>分析：在被调用函数内，一开始便读取寄存器，一开始读取堆栈的，读取的数据为函数参数</p></li></ul></li></ul><p>可通过ida反编译的伪代码辅助分析。例如ida识别为方法名<code>BLX func_xxx</code>，通过 <em>tab</em> 查看ida解析出来的参数个数辅助自己分析</p><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>mov r0, #5
mov r3, #4
mov r2, #3
str r0, [sp, #0]
mov r1, #2
mov r0, #1
BL func_test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时，第5个参数在调用前被存储在堆栈上</p></div><div id="comment" class="giscus-wrapper input-top" style="display:block;" data-v-77edf713><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div></div><!--]--><footer class="page_footer" data-v-2c01bf66><div class="footer_middle card_border" data-v-2c01bf66><!--[--><span data-v-2c01bf66>Released under the MIT License. <br data-v-2c01bf66></span><span data-v-2c01bf66>Copyright © 2023-present Leopold <br data-v-2c01bf66></span><!--]--></div></footer></div></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-942d488a.js" defer></script>
  </body>
</html>
