<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.68">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta property="og:url" content="https://saynop.github.io/detail/010.html"><meta property="og:title" content="安卓app的动态调试"><meta property="og:description" content="调试环境 IDA版本：7.0 进入IDA软件的数据路径 ida.app/Contents/MacOS/dbgsrv 注意： 根据so文件目录判断目标文件位数，v7a - 32位，v8是64位。使用不同的位数的ida进行调试 将文件夹内对应位数的android server文件传入手机 adb push android_server /data/local/tmp/"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Android"><meta property="article:tag" content="Reverse"><meta property="article:tag" content="IDA"><meta property="article:published_time" content="2023-10-18T00:00:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"安卓app的动态调试","image":[""],"datePublished":"2023-10-18T00:00:00.000Z","dateModified":null,"author":[]}</script><link rel="icon" href="/favicon.ico"><title>安卓app的动态调试</title><meta name="description" content="调试环境 IDA版本：7.0 进入IDA软件的数据路径 ida.app/Contents/MacOS/dbgsrv 注意： 根据so文件目录判断目标文件位数，v7a - 32位，v8是64位。使用不同的位数的ida进行调试 将文件夹内对应位数的android server文件传入手机 adb push android_server /data/local/tmp/">
    <link rel="preload" href="/assets/style-3253bf1b.css" as="style"><link rel="stylesheet" href="/assets/style-3253bf1b.css">
    <link rel="modulepreload" href="/assets/app-d35030ca.js"><link rel="modulepreload" href="/assets/010.html-a60b5c13.js"><link rel="modulepreload" href="/assets/010.html-f1724340.js">
    <link rel="prefetch" href="/assets/index.html-f33fda43.js" as="script"><link rel="prefetch" href="/assets/001.html-12451cc3.js" as="script"><link rel="prefetch" href="/assets/002.html-a6d5828c.js" as="script"><link rel="prefetch" href="/assets/003.html-3e8b49c2.js" as="script"><link rel="prefetch" href="/assets/004.html-689926d8.js" as="script"><link rel="prefetch" href="/assets/005.html-d6b96039.js" as="script"><link rel="prefetch" href="/assets/006.html-5b50a542.js" as="script"><link rel="prefetch" href="/assets/007.html-d3b6ddc8.js" as="script"><link rel="prefetch" href="/assets/008.html-834ef0e1.js" as="script"><link rel="prefetch" href="/assets/009.html-7d1574d7.js" as="script"><link rel="prefetch" href="/assets/011.html-10672fd1.js" as="script"><link rel="prefetch" href="/assets/012.html-5e7aa08e.js" as="script"><link rel="prefetch" href="/assets/013.html-8dd46ba3.js" as="script"><link rel="prefetch" href="/assets/014.html-d0db391f.js" as="script"><link rel="prefetch" href="/assets/015.html-7a04f43c.js" as="script"><link rel="prefetch" href="/assets/016.html-79bc20a6.js" as="script"><link rel="prefetch" href="/assets/017.html-f2df444a.js" as="script"><link rel="prefetch" href="/assets/404.html-a0fec2a7.js" as="script"><link rel="prefetch" href="/assets/index.html-75381ff5.js" as="script"><link rel="prefetch" href="/assets/index.html-c95ce669.js" as="script"><link rel="prefetch" href="/assets/index.html-2c56dc8e.js" as="script"><link rel="prefetch" href="/assets/index.html-98874abd.js" as="script"><link rel="prefetch" href="/assets/index.html-b2308fb7.js" as="script"><link rel="prefetch" href="/assets/index.html-10e703b4.js" as="script"><link rel="prefetch" href="/assets/index.html-5f3af54d.js" as="script"><link rel="prefetch" href="/assets/index.html-56349a98.js" as="script"><link rel="prefetch" href="/assets/index.html-a7c2713a.js" as="script"><link rel="prefetch" href="/assets/index.html-2e96c3d2.js" as="script"><link rel="prefetch" href="/assets/index.html-9f1eff22.js" as="script"><link rel="prefetch" href="/assets/index.html-16b34053.js" as="script"><link rel="prefetch" href="/assets/index.html-4e233464.js" as="script"><link rel="prefetch" href="/assets/index.html-d90f0ec9.js" as="script"><link rel="prefetch" href="/assets/index.html-3202320f.js" as="script"><link rel="prefetch" href="/assets/index.html-c3fe2c85.js" as="script"><link rel="prefetch" href="/assets/index.html-f3052411.js" as="script"><link rel="prefetch" href="/assets/index.html-5485bfc3.js" as="script"><link rel="prefetch" href="/assets/index.html-a7568890.js" as="script"><link rel="prefetch" href="/assets/index.html-9d25f5f2.js" as="script"><link rel="prefetch" href="/assets/index.html-ff33d682.js" as="script"><link rel="prefetch" href="/assets/index.html-3bce843e.js" as="script"><link rel="prefetch" href="/assets/index.html-09b9da96.js" as="script"><link rel="prefetch" href="/assets/index.html-750acad1.js" as="script"><link rel="prefetch" href="/assets/index.html-1c1e573d.js" as="script"><link rel="prefetch" href="/assets/index.html-8eb4570b.js" as="script"><link rel="prefetch" href="/assets/index.html-7dd1db94.js" as="script"><link rel="prefetch" href="/assets/index.html-32048506.js" as="script"><link rel="prefetch" href="/assets/index.html-a4e9e805.js" as="script"><link rel="prefetch" href="/assets/index.html-df3e534f.js" as="script"><link rel="prefetch" href="/assets/index.html-cb3cc9f5.js" as="script"><link rel="prefetch" href="/assets/index.html-0994fca8.js" as="script"><link rel="prefetch" href="/assets/index.html-a902e771.js" as="script"><link rel="prefetch" href="/assets/index.html-76fbbff6.js" as="script"><link rel="prefetch" href="/assets/index.html-7bc29919.js" as="script"><link rel="prefetch" href="/assets/index.html-2642a77f.js" as="script"><link rel="prefetch" href="/assets/index.html-8dfad283.js" as="script"><link rel="prefetch" href="/assets/index.html-0e75c0da.js" as="script"><link rel="prefetch" href="/assets/index.html-1d59d05d.js" as="script"><link rel="prefetch" href="/assets/index.html-073e77d0.js" as="script"><link rel="prefetch" href="/assets/001.html-aad0a93d.js" as="script"><link rel="prefetch" href="/assets/002.html-1d16a11a.js" as="script"><link rel="prefetch" href="/assets/003.html-cbc07b11.js" as="script"><link rel="prefetch" href="/assets/004.html-56740ddc.js" as="script"><link rel="prefetch" href="/assets/005.html-afd46512.js" as="script"><link rel="prefetch" href="/assets/006.html-8fffc43b.js" as="script"><link rel="prefetch" href="/assets/007.html-34f7e14e.js" as="script"><link rel="prefetch" href="/assets/008.html-8602ce70.js" as="script"><link rel="prefetch" href="/assets/009.html-55e14cef.js" as="script"><link rel="prefetch" href="/assets/011.html-89524e81.js" as="script"><link rel="prefetch" href="/assets/012.html-216db9e3.js" as="script"><link rel="prefetch" href="/assets/013.html-f429dc13.js" as="script"><link rel="prefetch" href="/assets/014.html-7acdde8d.js" as="script"><link rel="prefetch" href="/assets/015.html-c4ba315e.js" as="script"><link rel="prefetch" href="/assets/016.html-a2281481.js" as="script"><link rel="prefetch" href="/assets/017.html-1baab81d.js" as="script"><link rel="prefetch" href="/assets/404.html-9e799b24.js" as="script"><link rel="prefetch" href="/assets/index.html-ae7b74d8.js" as="script"><link rel="prefetch" href="/assets/index.html-6c26f9a1.js" as="script"><link rel="prefetch" href="/assets/index.html-0cb4222d.js" as="script"><link rel="prefetch" href="/assets/index.html-1ccd7388.js" as="script"><link rel="prefetch" href="/assets/index.html-cbda7201.js" as="script"><link rel="prefetch" href="/assets/index.html-3675ffcd.js" as="script"><link rel="prefetch" href="/assets/index.html-cc03e458.js" as="script"><link rel="prefetch" href="/assets/index.html-30ea76fa.js" as="script"><link rel="prefetch" href="/assets/index.html-86669c29.js" as="script"><link rel="prefetch" href="/assets/index.html-b271f298.js" as="script"><link rel="prefetch" href="/assets/index.html-86323e34.js" as="script"><link rel="prefetch" href="/assets/index.html-c6e1779d.js" as="script"><link rel="prefetch" href="/assets/index.html-a2938b69.js" as="script"><link rel="prefetch" href="/assets/index.html-85368404.js" as="script"><link rel="prefetch" href="/assets/index.html-8ace5aa5.js" as="script"><link rel="prefetch" href="/assets/index.html-28541726.js" as="script"><link rel="prefetch" href="/assets/index.html-756e0697.js" as="script"><link rel="prefetch" href="/assets/index.html-50ba59fa.js" as="script"><link rel="prefetch" href="/assets/index.html-6919497d.js" as="script"><link rel="prefetch" href="/assets/index.html-5d9bbd96.js" as="script"><link rel="prefetch" href="/assets/index.html-74e261e6.js" as="script"><link rel="prefetch" href="/assets/index.html-d449e5d4.js" as="script"><link rel="prefetch" href="/assets/index.html-87009249.js" as="script"><link rel="prefetch" href="/assets/index.html-d56fcdfa.js" as="script"><link rel="prefetch" href="/assets/index.html-205fb3be.js" as="script"><link rel="prefetch" href="/assets/index.html-bbb150d5.js" as="script"><link rel="prefetch" href="/assets/index.html-b380d4d1.js" as="script"><link rel="prefetch" href="/assets/index.html-d8567e5d.js" as="script"><link rel="prefetch" href="/assets/index.html-624be006.js" as="script"><link rel="prefetch" href="/assets/index.html-11a6e378.js" as="script"><link rel="prefetch" href="/assets/index.html-331ed367.js" as="script"><link rel="prefetch" href="/assets/index.html-2319ab3c.js" as="script"><link rel="prefetch" href="/assets/index.html-de786189.js" as="script"><link rel="prefetch" href="/assets/index.html-edea924d.js" as="script"><link rel="prefetch" href="/assets/index.html-5ca34618.js" as="script"><link rel="prefetch" href="/assets/index.html-ab69efa4.js" as="script"><link rel="prefetch" href="/assets/index.html-1695004b.js" as="script"><link rel="prefetch" href="/assets/index.html-311b6df4.js" as="script"><link rel="prefetch" href="/assets/index.html-97620357.js" as="script"><link rel="prefetch" href="/assets/giscus-0b7adcf8.js" as="script"><link rel="prefetch" href="/assets/SearchResult-a9869ee5.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div data-v-77edf713><header class="header" style="opacity:0;" data-v-90176301><div class="header_container" data-v-90176301><div data-v-90176301><a class="header_title" href="/" data-v-90176301>Leopold&#39;s Blog</a></div><div class="appearance" data-v-90176301><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">搜索</div><!----></button><!--]--><button class="switch" data-v-90176301><span class="icon" style="display:block;" data-v-90176301><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" style="" data-v-90176301><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" style="display:none;" data-v-90176301><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg></span></button><button class="switch mobile_list_btn" type="button" data-v-90176301><span class="btn_top" data-v-90176301></span><span class="btn_middle" data-v-90176301></span><span class="btn_bottom" data-v-90176301></span></button></div></div></header><div class="main"><div class="background" data-v-fee8de4c><svg class="pull_down" viewbox="0 0 1026 1024" xmlns="http://www.w3.org/2000/svg" data-v-fee8de4c data-v-3c8412b0><path d="M857.088 224.256q28.672-28.672 69.12-28.672t69.12 28.672q29.696 28.672 29.696 68.608t-29.696 68.608l-382.976 380.928q-12.288 14.336-30.72 19.968t-38.912 4.608-40.448-8.704-34.304-22.016l-376.832-374.784q-29.696-28.672-29.696-68.608t29.696-68.608q14.336-14.336 32.256-21.504t36.864-7.168 37.376 7.168 32.768 21.504l313.344 309.248z" data-v-3c8412b0></path></svg></div><div style="display:flex;"><div class="sider_keeper" data-v-e01a06ce><div class="folding" data-v-e01a06ce><!-- <div class="folding"> --><div class="sidebar_top card_border" style="min-height:1rem" data-v-e01a06ce><div class="tags_brand" data-v-e01a06ce>本文大纲</div><section class="article_sidebar" data-v-e01a06ce data-v-905b99e1><ul data-v-905b99e1><!--[--><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#调试环境" data-v-905b99e1>调试环境</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#动态调试" data-v-905b99e1>动态调试</a><ul class="level3" data-v-905b99e1><!--[--><li data-v-905b99e1><a class="sidebar-link" href="#debug调试" data-v-905b99e1>Debug调试</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><li data-v-905b99e1><a class="sidebar-link" href="#普通调试" data-v-905b99e1>普通调试</a><ul class="level4" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#调试jni-onload" data-v-905b99e1>调试JNI_OnLoad</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#动态调试时修改寄存器" data-v-905b99e1>动态调试时修改寄存器</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#动态调试时修改指令" data-v-905b99e1>动态调试时修改指令</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#关于ida调试时的几点" data-v-905b99e1>关于IDA调试时的几点</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#动态调试时的cpsr窗口" data-v-905b99e1>动态调试时的CPSR窗口</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><li class="level2" data-v-905b99e1><a class="sidebar-link" href="#调试可执行程序" data-v-905b99e1>调试可执行程序</a><ul class="level3" data-v-905b99e1><!--[--><!--]--></ul></li><!--]--></ul></section></div><div class="sidebar_bottom card_border" data-v-e01a06ce><div class="avatar" style="background-image:url(/assets/imgs/avatar.jpg);" data-v-e01a06ce></div><div class="author" data-v-e01a06ce>Leopold</div><div class="summary" data-v-e01a06ce><div data-v-e01a06ce><p data-v-e01a06ce>文章</p></div><div data-v-e01a06ce><p data-v-e01a06ce>分类</p></div><div data-v-e01a06ce><p data-v-e01a06ce>标签</p></div><div data-v-e01a06ce><p data-v-e01a06ce>17</p></div><div data-v-e01a06ce><p data-v-e01a06ce>9</p></div><div data-v-e01a06ce><p data-v-e01a06ce>28</p></div></div><div class="connection" data-v-e01a06ce><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M1023.560892 524.587752c0 114.331752-32.549236 217.148443-97.647709 308.450075-65.047295 91.301632-149.132822 154.455339-252.205404 189.512299-11.975662 2.303012-20.778286 0.716493-26.305515-4.759558a27.584966 27.584966 0 0 1-8.342021-20.471218V853.150798c0-44.166653-11.566238-76.511177-34.647536-96.982394a446.272549 446.272549 0 0 0 68.32269-12.282731c20.16415-5.476051 41.044792-14.329852 62.590748-26.612583a187.311643 187.311643 0 0 0 53.992837-45.446104c14.432209-18.014672 26.203159-41.914819 35.312851-71.751618 9.109692-29.8368 13.664538-64.074912 13.664538-102.765514 0-55.118754-17.554069-102.049021-52.61103-140.739623 16.376974-41.454216 14.636921-87.872703-5.373695-139.357815-12.436265-4.094244-30.399759-1.535341-53.941659 7.523172a355.17563 355.17563 0 0 0-61.311297 30.041513l-25.333132 16.376974a462.137743 462.137743 0 0 0-127.945112-17.707604 462.137743 462.137743 0 0 0-127.945111 17.758782 589.571074 589.571074 0 0 0-28.301459-18.424096c-11.77095-7.31846-30.34858-16.069906-55.681713-26.305515-25.281954-10.235609-44.422543-13.306292-57.31941-9.212048-19.498835 51.433935-21.085354 97.852421-4.606024 139.306637-35.108139 38.690602-52.713386 85.620869-52.713386 140.739623 0 38.690602 4.606024 72.826357 13.715716 102.458445 9.109692 29.58091 20.778286 53.481057 34.954605 71.700441a180.658498 180.658498 0 0 0 53.634591 45.753172c21.545957 12.282731 42.477777 21.18771 62.641926 26.612583 20.215328 5.527229 42.989557 9.621472 68.32269 12.333909-17.758781 16.376974-28.659705 39.867697-32.651593 70.369811a129.941055 129.941055 0 0 1-29.990334 10.235609 184.087426 184.087426 0 0 1-37.974109 3.428929c-14.688099 0-29.171485-4.913092-43.654872-14.688099-14.432209-9.826185-26.766117-24.053681-37.001726-42.682489a109.162769 109.162769 0 0 0-32.293346-35.517563c-13.101579-9.109692-24.104859-14.585743-33.009839-16.376974l-13.306292-2.047122c-9.314404 0-15.762838 1.023561-19.345301 3.070683-3.582463 2.047122-4.606024 4.606024-3.326572 7.83024a37.769397 37.769397 0 0 0 5.987831 9.570295 49.182101 49.182101 0 0 0 8.700267 8.188487l4.606024 3.377751c9.826185 4.606024 19.447657 13.255114 29.017952 25.998447 9.570294 12.743333 16.581686 24.360749 20.982998 34.80107l6.653146 15.71166c5.783119 17.298179 15.558126 31.320963 29.376197 42.017174 13.766894 10.747389 28.659705 17.554069 44.627255 20.471218 15.96755 2.968327 31.423319 4.606024 46.316131 4.810736 14.841633 0.204712 27.22672-0.562958 37.001726-2.405368l15.302235-2.712436c0 17.298179 0.102356 37.564685 0.358247 60.799517l0.307068 36.848192c0 8.188487-2.86597 15.046345-8.700268 20.471218-5.731941 5.527229-14.636921 7.113748-26.612583 4.810736-103.072582-35.056961-187.158109-98.261846-252.205404-189.512299C32.549236 741.736195 0 638.919504 0 524.587752c0-95.191163 22.876586-182.910331 68.629758-263.31104a516.028224 516.028224 0 0 1 186.288082-190.894106A491.309228 491.309228 0 0 1 511.780446 0.012795a491.309228 491.309228 0 0 1 256.913784 70.369811 516.028224 516.028224 0 0 1 186.236905 190.894106C1000.684306 341.626242 1023.560892 429.447767 1023.560892 524.587752z"></path></svg></div><div data-v-e01a06ce><span data-v-e01a06ce>github.com/SayNop</span></div><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M512 1024C229.222 1024 0 794.778 0 512S229.222 0 512 0s512 229.222 512 512-229.222 512-512 512z m259.149-568.883h-290.74a25.293 25.293 0 0 0-25.292 25.293l-0.026 63.206c0 13.952 11.315 25.293 25.267 25.293h177.024c13.978 0 25.293 11.315 25.293 25.267v12.646a75.853 75.853 0 0 1-75.853 75.853h-240.23a25.293 25.293 0 0 1-25.267-25.293V417.203a75.853 75.853 0 0 1 75.827-75.853h353.946a25.293 25.293 0 0 0 25.267-25.292l0.077-63.207a25.293 25.293 0 0 0-25.268-25.293H417.152a189.62 189.62 0 0 0-189.62 189.645V771.15c0 13.977 11.316 25.293 25.294 25.293h372.94a170.65 170.65 0 0 0 170.65-170.65V480.384a25.293 25.293 0 0 0-25.293-25.267z"></path></svg></div><div data-v-e01a06ce><span data-v-e01a06ce>gitee.com/WhenTimeGoesBy</span></div><!-- <div class="grid_icon"><mail_icon class="icon" /></div><div><span @click="open_link(themeData.connection_link.mail)">{{ themeData.connection_link.mail }}</span></div> --><div class="grid_icon" data-v-e01a06ce><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-e01a06ce><path d="M874.666667 181.333333H149.333333c-40.533333 0-74.666667 34.133333-74.666666 74.666667v512c0 40.533333 34.133333 74.666667 74.666666 74.666667h725.333334c40.533333 0 74.666667-34.133333 74.666666-74.666667V256c0-40.533333-34.133333-74.666667-74.666666-74.666667z m-725.333334 64h725.333334c6.4 0 10.666667 4.266667 10.666666 10.666667v25.6L512 516.266667l-373.333333-234.666667V256c0-6.4 4.266667-10.666667 10.666666-10.666667z m725.333334 533.333334H149.333333c-6.4 0-10.666667-4.266667-10.666666-10.666667V356.266667l356.266666 224c4.266667 4.266667 10.666667 4.266667 17.066667 4.266666s12.8-2.133333 17.066667-4.266666l356.266666-224V768c0 6.4-4.266667 10.666667-10.666666 10.666667z"></path></svg></div><div data-v-e01a06ce><a href="mailto:fur999immer@gmail.com" data-v-e01a06ce>fur999immer@gmail.com</a></div></div></div></div></div><div class="content_container"><!--[--><div class="card_border article_container" data-v-77edf713><div class="frontmatter_info" data-v-77edf713><h1 data-v-77edf713>安卓app的动态调试</h1><div data-v-77edf713>2023-10-18</div><div class="card_tag frontmatter_tags" data-v-77edf713><span class="icon" data-v-77edf713><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-77edf713><path d="M896 682.666667a42.666667 42.666667 0 0 0-42.666667-42.666667h-85.333333v-85.333333a85.333333 85.333333 0 0 0-85.333333-85.333334h-128V384h85.333333a42.666667 42.666667 0 0 0 42.666667-42.666667V170.666667a42.666667 42.666667 0 0 0-42.666667-42.666667H384a42.666667 42.666667 0 0 0-42.666667 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666667 42.666667h85.333333v85.333333H341.333333a85.333333 85.333333 0 0 0-85.333333 85.333334v85.333333H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666667 42.666667h256a42.666667 42.666667 0 0 0 42.666666-42.666667v-170.666666a42.666667 42.666667 0 0 0-42.666666-42.666667H341.333333v-85.333333h341.333334v85.333333h-85.333334a42.666667 42.666667 0 0 0-42.666666 42.666667v170.666666a42.666667 42.666667 0 0 0 42.666666 42.666667h256a42.666667 42.666667 0 0 0 42.666667-42.666667z"></path></svg></span><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_category" data-v-77edf713 data-v-c2920afd>Android</span><!--]--><span class="icon" style="margin-right:5px;" data-v-77edf713><svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" data-v-77edf713><path d="M985.6 473.6 985.6 473.6l-256 256-256 256 0 0C454.4 1011.2 422.4 1024 384 1024c-38.4 0-70.4-12.8-89.6-38.4l0 0-256-256 0 0C12.8 710.4 0 678.4 0 640c0-38.4 12.8-70.4 38.4-89.6l0 0 256-256 256-256 0 0C569.6 12.8 601.6 0 640 0l256 0c70.4 0 128 57.6 128 128l0 256C1024 422.4 1011.2 454.4 985.6 473.6zM768 128c-70.4 0-128 57.6-128 128 0 70.4 57.6 128 128 128 70.4 0 128-57.6 128-128C896 185.6 838.4 128 768 128z"></path></svg></span><!--[--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>Android</span><!--]--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>Reverse</span><!--]--><!--[--><!-- 使用冒泡stop，阻止父组件的跳转覆盖子组件 --><span class="article_tag" data-v-77edf713 data-v-15d5095d>IDA</span><!--]--><!--]--></div></div><div data-v-77edf713><h2 id="调试环境" tabindex="-1"><a class="header-anchor" href="#调试环境" aria-hidden="true">#</a> 调试环境</h2><p>IDA版本：<em>7.0</em></p><ul><li><p>进入IDA软件的数据路径 <em>ida.app/Contents/MacOS/dbgsrv</em><br><strong>注意：</strong> 根据so文件目录判断目标文件位数，v7a - 32位，v8是64位。使用不同的位数的ida进行调试</p></li><li><p>将文件夹内对应位数的android server文件传入手机</p></li></ul><div class="macos language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>adb push android_server /data/local/tmp/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>进入手机，运行android server</li></ul><div class="macos language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 进入手机 - 多台设备使用时使用-s参数设备名</span>
adb shell
<span class="token comment"># 切换管理员 - 才能进入tmp目录</span>
<span class="token function">su</span>
<span class="token comment"># 进入android server所在目录</span>
<span class="token builtin class-name">cd</span> /data/local/tmp/
<span class="token comment"># 给予android server最高权限</span>
<span class="token function">chmod</span> <span class="token number">777</span> android_server
<span class="token comment"># 运行android server 指定端口需要携带参数-p且无空格，例如`-p23456`</span>
./android_server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>将android server端口转发（需要使用新端口）</li></ul><div class="macos language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 将PC上的23946与手机23946建立转发</span>
<span class="token comment"># 参数中前者为local(PC端口) 后者为remote(手机端口)</span>
adb forward tcp:23946 tcp:23946

<span class="token comment"># 查看已转发端口</span>
adb forward <span class="token parameter variable">--list</span>
<span class="token comment"># 取消转发（填写PC端口）</span>
adb forward <span class="token parameter variable">--remove</span> tcp:11111
adb forward —-remove-all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上准备工作完成后便可通过IDA进行调试<br> 一般情况下会将android server进行重命名，并自定义端口号运行。防止app进行进程名与默认端口号检测</p><h2 id="动态调试" tabindex="-1"><a class="header-anchor" href="#动态调试" aria-hidden="true">#</a> 动态调试</h2><p>动态调试分为 Debug调试 与 普通调试。其中IDA调试栏选项的attach与run分别对应 附加进程 与 新建进程</p><h3 id="debug调试" tabindex="-1"><a class="header-anchor" href="#debug调试" aria-hidden="true">#</a> Debug调试</h3><p>脱壳或反调试时常用此方法</p><ul><li><p>挂起程序</p><ul><li>手机打开目标程序</li><li>依次打开 <em>IDA -&gt; Go -&gt; Debugger -&gt; Attach -&gt; Remote ARMLinux/Android debugger</em></li><li>填写监听地址。由于端口转发到本机，Host填写<code>127.0.0.1</code>，Port填写转发到主机的端口后点击OK，弹出手机进程列表</li><li>选择目标程序的运行进程，点击OK，完成<strong>进程附加</strong></li></ul></li><li><p>加载目标SO文件</p><ul><li>依次打开 <em>Debugger -&gt; Debugger options...</em></li><li>勾选三项 <ul><li>Suspend on process entry point (进程入口点挂起)</li><li>Suspend on thread start/exit (创建与退出线程时挂起)</li><li>Suspend on library load/unload (加载与卸载库时挂起)</li></ul></li><li>启动程序，图形按钮 或 快捷键F9</li><li>等待目标so库加载请求的弹窗，关闭后在Module窗口中搜索目标so库，在目标so中搜索目标函数或JNI_Onload，双击后下断点。再F9运行</li></ul></li></ul><h3 id="普通调试" tabindex="-1"><a class="header-anchor" href="#普通调试" aria-hidden="true">#</a> 普通调试</h3><ul><li><p>挂起程序</p><ul><li>通过jadx-gui打开app，在 <em>Resources -&gt; AndroidManifest.xml</em>（配置清单）中查找make launch（搜索LAUNCHER），找到activity中的<code>android:name=</code>，得到app的包名+类名</li><li>使用命令挂起程序</li></ul><div class="macos language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>adb shell am start <span class="token parameter variable">-D</span> <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>packageName<span class="token operator">&gt;</span>/.<span class="token operator">&lt;</span>className<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>执行完成后手机弹窗 <em>Waiting For Debugger</em></li></ul></li><li><p>得到程序端口：打开DDMS窗口，debug图标(红色的bug)会出现在目标进程前，记录目标程序运行的端口号<code>&lt;port&gt;</code></p></li></ul><div class="macos language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ddms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>依次打开 <em>IDA -&gt; Go -&gt; Debugger -&gt; Attach -&gt; Remote ARMLinux/Android debugger</em>。填写监听地址 <em>127.0.0.1+转发端口</em>。</p></li><li><p>选择目标程序的进行进程。勾选三项后F9让程序进入运行状态，此步骤与Debug调试一致</p></li><li><p>目标程序跳过ddms断点继续运行，此处端口为ddms端口</p></li></ul><div class="macos language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>jdb <span class="token parameter variable">-connect</span> com.sun.jdi.SocketAttach:hostname<span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此时ddms窗口中红色debug图标变为绿色，且ida可正常弹窗即将加载的so库，跳过弹窗使其正常加载。如需调试<code>JNI_OnLoad</code>或静态注册函数<code>Java_*</code>，先在函数中F2下断点后再F9运行<br></p><p><strong>问题：</strong></p><ul><li>打不开DDMS的办法 <ul><li>adb shell ps 得到进程PID<code>&lt;pid&gt;</code></li><li><code>adb forward tcp:xxx jdwp:&lt;pid&gt;</code></li><li>执行jdb</li></ul></li><li>调试时触发反调试或其他原因导致崩溃时重新调试 <ul><li>从挂起程序开始</li><li><code>adb shell am start -D -n ...</code></li><li>重新启动IDA并附加</li><li>勾选三项后F9</li><li>查看ddms中app端口是否变化</li><li>进行放手操作<code>jdb -connect ...</code></li></ul></li></ul><h2 id="调试jni-onload" tabindex="-1"><a class="header-anchor" href="#调试jni-onload" aria-hidden="true">#</a> 调试JNI_OnLoad</h2><ul><li>在右侧Modules窗口中搜索目标so文件</li><li>双击查看so中的函数，找到JNI_OnLoad。在汇编指令区F2下断点</li><li>取消三项勾选，使so正常运行不被非断点打断</li><li>F9运行</li></ul><h2 id="动态调试时修改寄存器" tabindex="-1"><a class="header-anchor" href="#动态调试时修改寄存器" aria-hidden="true">#</a> 动态调试时修改寄存器</h2><p>在条件判断时，常需要手动修改寄存器的值。例如 反调试检测、会员检测 等，不符合条件会触发分支逻辑</p><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>CMP RO 0
BNE sub_xxx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过在 寄存器窗口双击 或 快捷键<code>E</code> 进行修改</p><h2 id="动态调试时修改指令" tabindex="-1"><a class="header-anchor" href="#动态调试时修改指令" aria-hidden="true">#</a> 动态调试时修改指令</h2><p>由于<a href="/detail/011.html#%E4%B8%89%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF" class=""># 三级流水线</a>的存在， <strong>需在程序执行到前三条处指令前就完成对目标指令的修改</strong></p><ul><li>hex窗口中找到目标指令: 在执行到前三条时通过PC定位目标指令(选中目标指令 -&gt; hex窗口右键 -&gt; Synchronize with -&gt; IDA View-PC)</li><li>修改指令: 在hex窗口中快捷键F2进行编辑。编辑完成后使用快捷键F2进行保存。常改为全0使其变成<code>NOP</code></li><li>指令机器码计算: 查询《ARM指令》进行计算 或 使用https://armconverter.com/ ，输入目标指令和目标指令地址</li></ul><p>ARM指令共32位（4字节）从高位到低位依次查询ARM指令。以跳转指令<code>B</code>为例说明计算方式</p><ul><li>4位(32-28): 条件。指令是否含有条件，如<code>BNE</code>中的<code>NE</code></li><li>3位(27-25): 固定为<code>101</code></li><li>1位(24): 是否带链接，如<code>BL</code>中的<code>L</code></li><li>余下24位(23-0): 目标地址与该指令的相对偏移量（相差多少条指令），即 <code>( &lt;目标地址&gt; - PC ) / 4(单条指令4字节) </code>。由于<a href="/detail/011.html#%E4%B8%89%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF" class=""># 三级流水线</a>，PC值比当前执行的指令多两条指令(即指令地址+8)</li></ul><div class="language-assembly line-numbers-mode" data-ext="assembly"><pre class="language-assembly"><code>00001BD0  0B 00 00 0A  BEQ loc_1c04
; 偏移量为(0x1c04 - (0x1BD0+8)) / 4 = 11条 = 1011
; 0000 101 0 000000000000000000001011 -&gt; 0A00000B -&gt; 0B 00 00 0A (小端存放)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="关于ida调试时的几点" tabindex="-1"><a class="header-anchor" href="#关于ida调试时的几点" aria-hidden="true">#</a> 关于IDA调试时的几点</h2><ul><li><p>断点的实现：在断点处设置一个异常，调试器对其进行捕获，从而使程序暂停到断点处</p></li><li><p>勾选三项后的弹窗：找不到so的map文件（找不到so的调试符号信息，详情搜索调试符号），点击取消即可，不影响后期调试</p></li><li><p>寄存器或CPSR中的值若为黑色，则说明指令执行后对应空间内存储的值未发生改变。否则为蓝色</p></li><li><p>调试快捷键</p><ul><li>F2: 下断点</li><li>F4: 执行至光标处</li><li>F7: 单步执行</li><li>F9: 继续运行</li><li>寄存器快捷键E - 修改寄存器值</li><li>Ctrl + N: 设置PC</li></ul></li><li><p>关于汇编代码区颜色：</p><ul><li>黑色：可识别（可Tab得到C语言伪代码）</li><li>红色：不可识别</li></ul></li><li><p>代码区常用快捷键</p><ul><li>Tab：得到伪代码</li><li>D：选中代码识别成数据</li><li>U：选中代码识别成未识别数据</li><li>P：选中代码识别成函数（代码块）</li><li>C：选中代码识别成指令（行代码）因此经常先转化成代码（C）再将多条代码转化成函数（P）</li></ul></li></ul><h2 id="动态调试时的cpsr窗口" tabindex="-1"><a class="header-anchor" href="#动态调试时的cpsr窗口" aria-hidden="true">#</a> 动态调试时的CPSR窗口</h2><p>对IDA动态调试时常用CPSR标识位的说明</p><ul><li>N : 计算结果是否为负数</li><li>Z : 计算结果是否为0</li><li>C : 数值运算时是否出现进位或错位</li><li>T : 当前是否为Thumb指令集</li></ul><h2 id="调试可执行程序" tabindex="-1"><a class="header-anchor" href="#调试可执行程序" aria-hidden="true">#</a> 调试可执行程序</h2><p>初始流程与调试apk一致，运行android_server，启动端口转发</p><ul><li><p>点击菜单栏 <em>Debugger -&gt; Run -&gt; Remote ARMLinux/Android debugger</em></p></li><li><p><em>Application</em> 填写可执行文件的路径绝对路径</p></li><li><p><em>Directory</em> 填写可执行文件所在文件夹的绝对路径</p></li><li><p><em>Parameters</em> 填写可执行文件的运行参数。没有参数留空</p></li><li><p><em>Hostname</em> 127.0.0.1</p></li><li><p><em>Post</em> android_server转发端口</p></li><li><p>依次打开 <em>Debugger -&gt; Debugger options...</em> ，勾选三项</p></li></ul><p>更多内容查看后续IDA相关的文章</p></div><div id="comment" class="giscus-wrapper input-top" style="display:block;" data-v-77edf713><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div></div><!--]--><footer class="page_footer" data-v-2c01bf66><div class="footer_middle card_border" data-v-2c01bf66><!--[--><span data-v-2c01bf66>Released under the MIT License. <br data-v-2c01bf66></span><span data-v-2c01bf66>Copyright © 2023-present Leopold <br data-v-2c01bf66></span><!--]--></div></footer></div></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-d35030ca.js" defer></script>
  </body>
</html>
